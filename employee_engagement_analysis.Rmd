---
title: "employee_engagement_analysis"
author: "Daehyeon (Dae) Kim"
date: "2024-04-15"
output: html_document : github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Overview of This Report

This document shows my R codes that I used to clean and analyze Hooli's employee survey data. 
The document is structured as follows: 

* 1. Data preparation & processing for analysis 
* 2. Data Analysis
    - (1) Calculate the favorable scores (% of agree + strongly agree) for all questions and factors for Hooli overall.
    - (2) Calculate engagement factor favorable scores for all tenure groups.
    - (3) Calculate favorable scores for all questions and factors across different gender groups.
    - (4) Correlate all on-engagement questions to the engagement factor (full scale) for Hooli overall. 

# 1. Data preparation & processing for analysis 

## 1.a. Loading Data
```{r}
library(readxl)
df_original <- read_xlsx("data/sr._people_science_analyst_assignment_dataset_2024.xlsx")
```
## 1.b. Data exploration & preparation
  
  * 'lea_3' should be a numeric variable. After checking the data, employee ID M01562's response is only missing for'lea_3'. Therefore, this 'N/A' should be recoded as -1. 
  
  * 'hiredate' should be a date variable. It is also important to note that the current format is written differently based on the country that an employee is from (it's always important to check the entire dataset!!). 
  Australia: Day/Month/Year
  Denmark: Day/Month/Year
  France: Day/Month/Year
  Germany: Day/Month/Year
  India: Day/Month/Year
  UK: Day/Month/Year
  United Kingdom: Day/Month/Year
  United States: Month/Day/Year
  USA: Month/Day/Year
  Canada: Month/Day/Year
  China: Year/Month/Day
  So in converting this variable to date-type, I need to specify this format in my code. 

```{r}
#checking the macro-level trends of the dataset 

head(df_original, 5)
tail(df_original, 5)
str(df_original)

library(Amelia)
missmap(df_original, main = 'missing data map for the Hooli Survey Data', col = c('purple', 'black'), legend = TRUE)
#except for race, most values are not missing!

#Creating a new dataset that I will prepare and process for analysis

df <- df_original 

#Fixing errors in 'lea_3'

table(df_original$lea_3)
df[df$lea_3 == "N/A", ]
df$lea_3[df$lea_3 == "N/A"] <- -1
table(df$lea_3)

#transforming 'lea_3' to a numeric variable
df$lea_3 <- as.numeric(df$lea_3)

library(dplyr)

df <- df %>%
  mutate(hiredate = case_when(
    country %in% c("Australia", "Denmark", "France", "Germany", "India", "UK", "United Kingdom") ~ as.Date(hiredate, format = "%d/%m/%Y"),
    country %in% c("United States", "USA", "Canada") ~ as.Date(hiredate, format = "%m/%d/%Y"),
    country == "China" ~ as.Date(hiredate, format = "%Y/%m/%d"),
    TRUE ~ as.Date(NA)  
  ))

library(summarytools)
dfSummary(df$hiredate)

```

  * Handling outliers, '99', in various variables

I identified several outliers, value 99, from these variables: ali_1, ali_2, ali_3, col_1, col_2, col_3, and lea_4. The value 99 is a value that is out of the scale of -1 to 5. I discovered that all these responses come from Denmark. Thus, it was probably a systematic coding error for these responses from Denmark. Given that these are psychological measures, it doesn't make sense code 99 might denote an exceptional response out of -1 to 5 scale. Thus, I deem 99 as a coding error. Additionally, these employees are less than 1% of the participants in the data and that they completed all the other questions in the survey. Therefore, I recode 99 to -1, the code for missing value. 
    
```{r}
library(summarytools)
dfSummary(df)

#examine the responses of the employees who responded '99' to one of these questions.
df[df$ali_1 == 99, ] # other responses are in the normal scale range & 2 participants = M00238 & M00568
df[df$ali_2 == 99, ] # except for ali_2 & lea_4, all the other responses are in the normal scale range & 1 participant = M01455
df[df$ali_3 == 99, ] # other responses are in the normal scale range & 1 participant = M02319
df[df$col_1 == 99, ] # other responses are in the normal scale range & 2 participants = M01339, M01843
df[df$col_2 == 99, ] # other responses are in the normal scale range & 1 participant = M00168
df[df$col_3 == 99, ] # other responses are in the normal scale range & 1 participant = M01393
df[df$lea_3 == 99, ] # except fo lea_3, all the other responses are in the normal scale range & 1 participant = M01484
df[df$lea_4 == 99, ] # except for ali_2 & lea_4, all the other responses are in the normal scale range & 1 participant = M01455

# recode values with 99 to -1.

df$ali_1[df$ali_1 == 99] <- -1
df$ali_2[df$ali_2 == 99] <- -1
df$ali_3[df$ali_3 == 99] <- -1
df$col_1[df$col_1 == 99] <- -1
df$col_2[df$col_2 == 99] <- -1
df$col_3[df$col_3 == 99] <- -1
df$lea_3[df$lea_3 == 99] <- -1
df$lea_4[df$lea_4 == 99] <- -1

```
  * col_1, eng_2, inc_2, & inc_5 have 1 missing value each. It should be correctly coded as -1, the correct code for missing values.
  
```{r}
df[is.na(df$col_1), ] #for employee_ID M02429, only col_1 is missing. It should be coded as -1. 
df[is.na(df$eng_2), ] #for employee_ID M01597, only eng_2 is missing. It should be coded as -1.
df[is.na(df$inc_2), ] #for employee_ID M01481, only inc_2 is missing. It should be coded as -1.
df[is.na(df$inc_5), ] #for employee_ID M01722, only inc_5 is missing. It should be coded as -1. 

df$col_1[is.na(df$col_1)] <- -1
df$eng_2[is.na(df$eng_2)] <- -1
df$inc_2[is.na(df$inc_2)] <- -1
df$inc_5[is.na(df$inc_5)] <- -1

```
  * Checking for duplicates: there are no duplicates based on employee ID. each response comes from a unique employee
  
```{r}
sum(duplicated(df$eeid))
```
  
  * For the 'country' variable, 'UK' and 'United Kingdom' should be merged into one category. Similarly, 'USA' and 'United States' should be merged into one category. Let's combine these categories for each country.
  
```{r}
table(df$country)
df$country[df$country == "UK"] <- "United Kingdom"
df$country[df$country == "USA"] <- "United States"
table(df$country)

```
  * For 'age' variable, multiple categories need to be consolidated:   
    - the group '19', '21' should be consolidated into '18-24'.
    - the group '26', '28' should be consolidated into '25-34'.
    - the group '39', '42' should be consolidated into '35-44'.
    - the group '48' should be consolidated into '45-54'.
    
```{r}
table(df$age, useNA = "always")

df$age[df$age == "19"] <- "18-24"
df$age[df$age == "21"] <- "18-24"
df$age[df$age == "26"] <- "25-34"
df$age[df$age == "28"] <- "25-34"
df$age[df$age == "39"] <- "35-44"
df$age[df$age == "42"] <- "35-44"
df$age[df$age == "48"] <- "45-54"


```
  * For 'race' variable, "Black or African American" & "Black or African Americans" should be mergedinto one group.
  
```{r}
table(df$race, useNA = "always")
df$race[df$race == "Black or African Americans"] <- "Black or African American"
```
  * For 'gender' variable, these groups below need to be consolidated:
    -Consolidate "Male" & "Man" into one group
    -Consolidate "Female" & "Woman" into one group
    
```{r}
table(df$gender, useNA = "always")
df$gender[df$gender == "Man"] <- "Male"
df$gender[df$gender == "Woman"] <- "Female"

```
  * 40.2% of race variable's observations (1067) are missing. Let's see if the values in this variable has patterns. 
    
      Based on the contingency table below, 
      - 101/101 employees in Australia have no information about their race. 
      - 60/84 employees in Canada have no information about their race except 24 who are white.
      - 55/60 employees in China have no information about their race except 5 who are white.
      - 24/24 employees in Denmark have no information about their race.
      - 136/136 employees in France have no information about their race.
      - 48/48 employees in Germany have no information about their race. 
      - 288/288 employees in India have no information about their race. 
      - 355/359 employees in the United Kingdom have no information about their race.
      - 1017/1017 employees in the United States have demographic information about race. 

Except for the United States, all the countries with missing information about race are largely ethnically homogeneous (e.g., Denmark). Therefore, the company might not collect information about employee's race as the variance in race among employees might be too small to be a meaningful (For example, according to demographic research, about 90.2 percent of the population in Australia are white). Therefore, conducting an analysis about race for other countries except for the United States would not provide meaningful insights to Hooli.  
```{r}
c_t <- table(df$race, df$country, useNA = "always")
c_t
```

    * 0% of 'hiredate' variable's observations are missing. 
```{r}
df_2 <- subset(df, select = c(hiredate))
library(Amelia)
missmap(df_2)
rm(df_2)

#the earliest & latest date for hiredate
min(df$hiredate, na.rm = TRUE) # 2014-12-24
max(df$hiredate, na.rm = TRUE) # 2024-02-29


#let's create a new variable named hireyear 
df$hireyear <- format(df$hiredate, "%Y")
table(df$hireyear, useNA = "always")
library(ggplot2)
ggplot(df, aes(x=hireyear)) + geom_bar()
ggplot(df, aes(x=hiredate)) + geom_histogram() #this company hired employees a ton in 2022!!


```
   * Create a new variable called 'tenure' by using hiredate.
      
      Substract 'hiredate' from March 1st 2024, the date instructed by the technical assessment rubric to create different tenure groups by using 'hiredate'. It's important to note that there are 11 employees who were hired on or after March 1st 2024. However, given that I am asked to analyze the data as of March 1st 2024, I omit these 11 observations to not introduce a bias in my data. For example, introducing this 11 observations into under 3 months might change the characteristics of those in that group as of March 1st 2024. 
      
      - Given that there are only 4 employees in '10+ years' groups, we do not report any findings about this group.
      
```{r}
#let's create the cutpoint, which is 2024-03-01, to create tenure groups
cutpoint <- as.Date("2024-03-01")
#given that the average number of days in a month is 365/12 = 30.4166666667, 
tenure_days <- as.numeric(difftime(cutpoint, df$hiredate, units = "days"))
tenure_months <- as.numeric(difftime(cutpoint, df$hiredate, units = "days")/(365/12))

#create tenure_groups 
tenure_groups <- cut(tenure_months,
                      breaks = c(0, 3, 6, 12, 24, 48, 72, 120, Inf),  # In months
                      labels = c("Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years", "10+ years"), right = FALSE) # right = FALSE to EXCLUDE the right side month in the cateogry

#the distribution of employees in each tenure group
table(tenure_groups, useNA = "always")
# Add tenure_group variable to data frame
df$tenure_group <- as.character(tenure_groups)

# Print the data frame with the new tenure_group variable
table(df$tenure_group, useNA = "always")

```

  * Changing all the missing values to NA (I named this new dataset df_2) to make sure that '-1' does not influence the results of our analysis. 
  
```{r}

df_2 <- df

df_2$ali_1[df_2$ali_1 == -1] <- NA 
df_2$ali_2[df_2$ali_2 == -1] <- NA
df_2$ali_3[df_2$ali_3 == -1] <- NA

df_2$col_1[df_2$col_1 == -1] <- NA 
df_2$col_2[df_2$col_2 == -1] <- NA 
df_2$col_3[df_2$col_3 == -1] <- NA 

df_2$eng_1[df_2$eng_1 == -1] <- NA 
df_2$eng_2[df_2$eng_2 == -1] <- NA
df_2$eng_3[df_2$eng_3 == -1] <- NA 
df_2$eng_4[df_2$eng_4 == -1] <- NA
df_2$eng_5[df_2$eng_5 == -1] <- NA

df_2$inc_1[df_2$inc_1 == -1] <- NA 
df_2$inc_2[df_2$inc_2 == -1] <- NA
df_2$inc_3[df_2$inc_3 == -1] <- NA
df_2$inc_4[df_2$inc_4 == -1] <- NA
df_2$inc_5[df_2$inc_5 == -1] <- NA 

df_2$lea_1[df_2$lea_1 == -1] <- NA
df_2$lea_2[df_2$lea_2 == -1] <- NA
df_2$lea_3[df_2$lea_3 == -1] <- NA
df_2$lea_4[df_2$lea_4 == -1] <- NA

df_2$age[df_2$age == "N/A"] <- NA

#we convert "Unknown" to NA as this category has less than 5 people and we do not report.
df_2$gender[df_2$gender == "Unknown"] <- NA

dfSummary(df_2)

#the end of data-processing & preparation for analysis
```
  
  
  # 2. Data Analysis
  
  * (1) Calculate the favorable scores for all questions and factors for Hooli Overall.
    - a. The favorability scores for all questions below:
```{r}
dfSummary(df_2)
favorability_ali_1 <- sum(df_2$ali_1 %in% c(4,5))/sum(df_2$ali_1 %in% c(1:5))
favorability_ali_1

#let's create a function that automatates the process of calculating favorability scores for all questions at once:

function_favorability <- function(df) {
  favorability_score <- numeric(ncol(df))  # Include all columns
  column_names <- names(df)  # Get the column names
  
  for (i in 1:ncol(df)) {  # Start from column 1
    # Calculate the proportion
    favorability_score[i] <- sum(df[[i]] %in% c(4,5)) / sum(df[[i]] %in% c(1:5))
  }
  
  # Combine favorability scores and column names into a data frame
  result <- data.frame(column_name = column_names, favorability_score = favorability_score)
  
  return(result)
}

# Calculate favorability_score for columns 2 to 21
favorability_score <- function_favorability(df_2[, 2:21])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  
print(favorability_score_percent)


#graph favorable score for each question
##setting different colors for different factors

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")

##

group_colors <- c(
  "Alignment" = "#D08770",  # Light orange for Group 1
  "Collaboration" = "#A3BE8C",  # Light green for Group 2
  "Engagement" = "#5E81AC",  # Light blue for Group 3
  "Inclusion" = "#EBCB8B",  # Light yellow for Group 4
  "Leadership" = "#B48EAD"   # Mild purple for Group 5
)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars
```
      - b. Calculate a 'Factor Favorable Score', which is the average favorable score among questions within a factor, for each factor.
```{r}
#let's create a function that automates the process of calculating of factor favorable score.

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's enagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Overall",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



#create a graph that shows enagement favorable score across tenure groups (all)

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # Purple for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

```
  * 2. Calculate engagement factor (favorable) scores by all tenure groups (need to clarify this question..)
    - a. engagement factor favorable scores for employees whose tenure are "Under 3 Months".
      n = 64
      
```{r}

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$tenure_group == "Under 3 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those under 3 months
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # Purple for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with Under 3 Months Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "Under 3 Months"

```
  - b.engagement factor favorability scores for employees whose tenure are "3-6 months".
      n = 325
```{r}
#3-6 months
df_2[df_2$tenure_group == "3-6 months" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "3-6 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 3-6 months tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)

average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

# graph showing engagement factor scores for the 3-6 months tenure group

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 3-6 Months Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "3-6 Months"
```  
    - c.engagement factor favorability scores for employees whose tenure are "6-12 months".
      n = 507
```{r}
#6-12 months
df_2[df_2$tenure_group == "6-12 months" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "6-12 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 6-12 months tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

# graph showing engagement factor scores for the 6-12 months tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 6-12 Months Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "6-12 Months"
```  
   
    - d. engagement factor favorability scores for employees whose tenure are "1-2 years".
      N = 670
```{r}

#1-2 years
df_2[df_2$tenure_group == "1-2 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "1-2 years", 8:12])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 1-2 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 1-2 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 1-2 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "1-2 Years"

```  

    - e. engagement factor favorability scores for employees whose tenure are "2-4 years".
      n = 644
```{r}
#2-4 years
df_2[df_2$tenure_group == "2-4 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "2-4 years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 2-4 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores




# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 2-4 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 2-4 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
   
   
#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "2-4 Years"

```
    - f. engagement factor scores for employees whose tenure are "4-6 years".
      N = 274
```{r}
#4-6 years
df_2[df_2$tenure_group == "4-6 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "4-6 years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 4-6 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)

# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 4-6 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 4-6 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
   


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "4-6 Years"

```
     - g. engagement factor scores for employees whose tenure are "6-10 years".
       N = 163
```{r}

#6-10 years
df_2[df_2$tenure_group == "6-10 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "6-10 years", 8:12])


colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 6-10 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)



# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 6-10 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 6-10 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "6-10 Years"

```
   - h. engagement factor scores for employees whose tenure are "10+ years".
    N = 4, given that this category has less than 5 employees, we don't report it.
```{r}

#it is critical that there are only 2 employees who have worked longer than 10 years.

#10+ years
df_2[df_2$tenure_group == "10+ years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "10+ years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with over 10 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with Over 10 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)
```
 
    - i. Engagement factor favorable scores across tenure groups (employee life cycle)
```{r}
engagement_by_tenure$favorability_score <- round(engagement_by_tenure$favorability_score*100)
engagement_by_tenure$question_number <- factor(engagement_by_tenure$question_number, levels = engagement_by_tenure$question_number)

engagement_by_tenure
# Distinguish the average row from other item rows
engagement_by_tenure$highlight <- ifelse(engagement_by_tenure$question_number == engagement_by_tenure$question_number[1], "first", "other")


# graph showing engagement factor scores across tenure groups 
ggplot(engagement_by_tenure, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores Across Tenure Groups") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 11),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


```
  
  * 3. Calculate favorable scores for all questions and factors by gender
    - a. favorable scores for all questions and factors for women
        - N for female = 820
        
```{r}
table(df_2$gender)
df_2[df_2$gender== "Female" & !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$gender == "Female", 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")


print(favorability_score_percent)


## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")


#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Overall",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


#create a graph that shows engagement favorable score across tenure groups (all)

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

#Create a ggplot that shows engagement factor favorable scores for women

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

```
    
    - b. favorable scores for all questions and factors for men
        N = 1830
```{r}
# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$gender == "Male", 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  
print(favorability_score_percent)

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")


print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")


#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores 

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Overall",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


#create a graph that shows engagement favorable score across tenure groups (all)

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

# create a graph that shows engagement factor favorable scores for men 
ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
 

 - c. favorable scores for all questions for women for Under 3 months
      N = 25
```{r}
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "Under 3 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "Under 3 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Under 3 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



#create a graph that shows engagement favorable scores for women with tenure under 3 months  

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure Under 3 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

- d. favorable scores for all questions for women with tenure between 3-6 months 
      N = 116
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "3-6 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "3-6 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")


print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "3-6 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 3-6 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
 - f. favorable scores for all questions for women with tenure between 6-12 months 
      N = 181
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-12 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-12 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-12 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 6 and 12 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```


- e. favorable scores for all questions for women with tenure between 1-2 years 
      N = 211
      
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "1-2 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "1-2 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "1-2 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 1-2 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```


- f. favorable scores for all questions for women with tenure between 2-4 years 
      N = 191
      
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "2-4 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "2-4 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "2-4 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 2-4 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```


- g. favorable scores for all questions for women with tenure between 4-6 years 
      N = 58
      
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "4-6 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "4-6 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100


library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "4-6 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 4-6 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

- h. favorable scores for all questions for women with tenure between 6-10 years 
      N = 37
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-10 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-10 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-10 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 6-10 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
 
 - i. favorable scores for all questions for Men for Under 3 months
      N = 39
```{r}
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "Under 3 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "Under 3 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")

#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Under 3 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



#create a graph that shows engagement favorable score across tenure groups 

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure Under 3 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
  - j. favorable scores for all questions for Men with tenure between 3-6 months 
      N = 116
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "3-6 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "3-6 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100


library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "3-6 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 3-6 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
 
 - k. favorable scores for all questions for Men with tenure between 6-12 months 
      N = 181
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-12 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-12 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-12 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 6 and 12 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

- l. favorable scores for all questions for Men with tenure between 1-2 years 
      N = 
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "1-2 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "1-2 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)



#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "1-2 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 1-2 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

  - n. favorable scores for all questions for Men with tenure between 2-4 years 
      N = 
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "2-4 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "2-4 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100


library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "2-4 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 2-4 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

  - m. favorable scores for all questions for Men with tenure between 4-6 years 
      N = 
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "4-6 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "4-6 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "4-6 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 4-6 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

  - o. favorable scores for all questions for Men with tenure between 6-10 years 
      N = 
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-10 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-10 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-10 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 6-10 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors) 
```

 
  * 4. Correlate all non-engagement questions to the engagement factor for Hooli Overall.
      -  a. for all employees (Kendall's tau-b)
      The results from the correlations calculated by conducting Kendall's tau-b and pearson's r are largley convergent while kendall's tau-b's results are much more conservative in terms of the size of the correlations. 

```{r}
#Create a new variable named 'engagement_factor', representing the average engagement scores.
df_2$engagement_factor <- rowMeans(df_2[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

#Select only the numeric columns from 'df_2' excluding 'eng_1' to 'eng_5'
numeric_df_2 <- Filter(is.numeric, df_2)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```

     -  b. for women only (correlation calculated by conducting kendall's tau-b)
```{r}

library(dplyr)

# Subset df_2 to include only female employees
df_2_female <- df_2 %>%
  filter(gender == "Female")

# Calculate the engagement factor for female employees
df_2_female$engagement_factor <- rowMeans(df_2_female[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)


numeric_df_2 <- Filter(is.numeric, df_2_female)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Women", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Women", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
   c. for male employees (correlation calculated by conducting kendall's tau-b)
```{r}
library(dplyr)

# Subset df_2 to include only female employees
df_2_male <- df_2 %>%
  filter(gender == "Male")

# Calculate the engagement factor for female employees
df_2_male$engagement_factor <- rowMeans(df_2_male[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

# Display a few rows to check the new variable
head(df_2_male)

numeric_df_2 <- Filter(is.numeric, df_2_male)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Men", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Men", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
  * 5. Calculate engagement & leadership factor scores for all countries.
    - a. Australia's N = 101
   

```{r}
df_2[df_2$country == "Australia" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Australia", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Australia"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```
    - b. Canada's N = 84
```{r}
df_2[df_2$country == "Canada" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Canada", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Canada"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```
    - c. China's N = 60
```{r}
df_2[df_2$country == "China" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "China", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "China"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```
    - d. Denmark's N = 24
```{r}
df_2[df_2$country == "Denmark" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Denmark", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Denmark"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```
    - e. France's N = 136
```{r}
df_2[df_2$country == "France" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "France", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "France"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```  
    - f. Germany's N = 48

```{r}
df_2[df_2$country == "Germany" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Germany", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Germany"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```

    - g. India's N = 288
    
```{r}

df_2[df_2$country == "India" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "India", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "India"  # Add the country label
    )
  )
}


print(factor_favorable_score)

```

    - h. United Kingdom's N = 359
    
```{r}
df_2[df_2$country == "United Kingdom" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "United Kingdom", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "United Kingdom"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```

    - i. United States' N = 1551
    
```{r}

df_2[df_2$country == "United States" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "United Kingdom", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "United States"  # Add the country label
    )
  )
}


print(factor_favorable_score)
```
     - j. create a visual that compares factor favorable scores for engagement & leadership across countries
     
```{r}
#Create an empty data frame to save the consolidated favorable_scores
consolidated_favorable_scores <- data.frame(
  factor_abbreviation = character(),
  factor_favorable_score = numeric(),
  country = character(),
  stringsAsFactors = FALSE
)

#list of countries
countries <- c("Australia", "Canada", "China", "Denmark", "France", "Germany", "India", "United Kingdom", "United States")  

#Loop through each country and calculate factor favorable score
for (country in countries) {
  #Filter data for the specific country
  country_df <- df_2[df_2$country == country & !is.na(df_2$country), ]
  
  #Calculate favorability_score using a custom function
  favorability_score <- function_favorability(country_df[, c(8:12, 18:21)])
  colnames(favorability_score)[1] <- "question_number"
  
  factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number))
  
  #Create a data frame for this country's factor_favorable_score (so a dataframe within a loop)
  factor_favorable_score <- data.frame(
    factor_abbreviation = character(),
    factor_favorable_score = numeric(),
    country = character(),
    stringsAsFactors = FALSE
  )
  
  #Calculate the average favorable score for each factor
  for (factor_abbr in factor_abbreviations) {
    #Subset favorable scores for the factor
    factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    
    #Calculate the average favorable score
    avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)
    
    #Append the calculated score to the country's data frame
    factor_favorable_score <- rbind(
      factor_favorable_score,
      data.frame(
        factor_abbreviation = factor_abbr,
        factor_favorable_score = avg_favorable_score,
        country = country  # Add the country label
      )
    )
  }
  
  #Consolidate this country's data frame into the main consolidated data frame
  consolidated_favorable_scores <- rbind(
    consolidated_favorable_scores,
    factor_favorable_score
  )
}

print(consolidated_favorable_scores)


#Sort the data frame by factor_favorable_score 
consolidated_favorable_scores <- consolidated_favorable_scores %>%
  arrange(desc(factor_favorable_score))

#Reorder the factor levels based on the sorted data frame
consolidated_favorable_scores$factor_abbreviation <- factor(
  consolidated_favorable_scores$factor_abbreviation,
  levels = unique(consolidated_favorable_scores$factor_abbreviation)  
)
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(scales)

# Filter the data into two subsets: one for 'lea' (leadership factor) and one for 'eng' (engagement factor)
leadership_scores <- consolidated_favorable_scores %>%
  filter(factor_abbreviation == "lea")

engagement_scores <- consolidated_favorable_scores %>%
  filter(factor_abbreviation == "eng")

# Reorder the factor levels based on the sorted data frame
leadership_scores$country <- factor(
  leadership_scores$country,
  levels = unique(leadership_scores$country)
)

engagement_scores$country <- factor(
  engagement_scores$country,
  levels = unique(engagement_scores$country)
)

# Create ggplot for leadership scores
ggplot(leadership_scores, aes(x = country, y = factor_favorable_score * 100, fill = country)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  geom_text(
    aes(label = paste0(round(factor_favorable_score * 100, 1), "%")),
    position = position_dodge(width = 0.9),
    vjust = -0.5  # Position the text above the bars
  ) +
  labs(
    x = "Country",
    y = "Leadership Favorability Score (%)",
    title = "Leadership Factor Favorable Scores by Country (%)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

# Create ggplot for engagement scores
ggplot(engagement_scores, aes(x = country, y = factor_favorable_score * 100, fill = country)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  geom_text(
    aes(label = paste0(round(factor_favorable_score * 100, 1), "%")),
    position = position_dodge(width = 0.9),
    vjust = -0.5  # Position the text above the bars
  ) +
  labs(
    x = "Country",
    y = "Engagement Favorability Score (%)",
    title = "Engagement Factor Favorable Scores by Country (%)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )
```
     
     