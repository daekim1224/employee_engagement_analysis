---
title: "employee_engagement_analysis"
author: "Daehyeon (Dae) Kim"
date: "2024-04-15"
output: html_document : github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Overview of This Report

This document shows my R codes that I used to clean and analyze Hooli's employee survey data. 
The document is structured as follows: 

* 1. Data preparation & processing for analysis 
* 2. Data Analysis
    - (1) Calculate the favorable scores (% of agree + strongly agree) for all questions and factors for Hooli overall.
    - (2) Calculate engagement factor favorable scores for all tenure groups.
    - (3) Calculate favorable scores for all questions and factors across different gender groups.
    - (4) Correlate all on-engagement questions to the engagement factor (full scale) for Hooli overall. 

# 1. Data preparation & processing for analysis 

## 1.a. Loading Data
```{r}
library(readxl)
df_original <- read_xlsx("data/sr._people_science_analyst_assignment_dataset_2024.xlsx")
```
## 1.b. Data exploration & preparation
  
  * 'lea_3' should be a numeric variable. After checking the data, employee ID M01562's response is only missing for'lea_3'. Therefore, this 'N/A' should be recoded as -1. 
  
  * 'hiredate' should be a date variable. It is also important to note that the current format is written as day/month/year. So in converting this variable to date-type, I need to specify this format in my code. 

```{r}
#checking the macro-level trends of the dataset 

head(df_original, 5)
tail(df_original, 5)
str(df_original)

#Creating a new dataset that I will prepare and process for analysis

df <- df_original 

#Fixing errors in 'lea_3'

table(df_original$lea_3)
df[df$lea_3 == "N/A", ]
df$lea_3[df$lea_3 == "N/A"] <- -1
table(df$lea_3)

#transforming 'lea_3' to a numeric variable
df$lea_3 <- as.numeric(df$lea_3)

#transforming 'hiredate' into a date variable.
df$hiredate <- as.Date(df$hiredate, format = "%d/%m/%Y")
str(df)

```

  * Handling outliers, '99', in various variables

I identified several outliers, value 99, from these variables: ali_1, ali_2, ali_3, col_1, col_2, col_3, and lea_4. The value 99 is a value that is out of the scale of -1 to 5. I discovered that all these responses come from Denmark. Thus, it was probably a systematic coding error for these responses from Denmark. Given that these are psychological measures, it doesn't make sense code 99 might denote an exceptional response out of -1 to 5 scale. Thus, I deem 99 as a coding error. Additionally, these employees are less than 1% of the participants in the data and that they completed all the other questions in the survey. Therefore, I recode 99 to -1, the code for missing value. 
    
```{r}
library(summarytools)
dfSummary(df)

#examine the responses of the employees who responded '99' to one of these questions.
df[df$ali_1 == 99, ] # other responses are in the normal scale range & 2 participants = M00238 & M00568
df[df$ali_2 == 99, ] # except for ali_2 & lea_4, all the other responses are in the normal scale range & 1 participant = M01455
df[df$ali_3 == 99, ] # other responses are in the normal scale range & 1 participant = M02319
df[df$col_1 == 99, ] # other responses are in the normal scale range & 2 participants = M01339, M01843
df[df$col_2 == 99, ] # other responses are in the normal scale range & 1 participant = M00168
df[df$col_3 == 99, ] # other responses are in the normal scale range & 1 participant = M01393
df[df$lea_3 == 99, ] # except fo lea_3, all the other responses are in the normal scale range & 1 participant = M01484
df[df$lea_4 == 99, ] # except for ali_2 & lea_4, all the other responses are in the normal scale range & 1 participant = M01455

# recode values with 99 to -1.

df$ali_1[df$ali_1 == 99] <- -1
df$ali_2[df$ali_2 == 99] <- -1
df$ali_3[df$ali_3 == 99] <- -1
df$col_1[df$col_1 == 99] <- -1
df$col_2[df$col_2 == 99] <- -1
df$col_3[df$col_3 == 99] <- -1
df$lea_3[df$lea_3 == 99] <- -1
df$lea_4[df$lea_4 == 99] <- -1

```
  * col_1, eng_2, inc_2, & inc_5 have 1 missing value each. It should be correctly coded as -1, the correct code for missing values.
  
```{r}
df[is.na(df$col_1), ] #for employee_ID M02429, only col_1 is missing. It should be coded as -1. 
df[is.na(df$eng_2), ] #for employee_ID M01597, only eng_2 is missing. It should be coded as -1.
df[is.na(df$inc_2), ] #for employee_ID M01481, only inc_2 is missing. It should be coded as -1.
df[is.na(df$inc_5), ] #for employee_ID M01722, only inc_5 is missing. It should be coded as -1. 

df$col_1[is.na(df$col_1)] <- -1
df$eng_2[is.na(df$eng_2)] <- -1
df$inc_2[is.na(df$inc_2)] <- -1
df$inc_5[is.na(df$inc_5)] <- -1

```
  * Checking for duplicates: there are no duplicates based on employee ID. each response comes from a unique employee
  
```{r}
sum(duplicated(df$eeid))
```
  
  * For the 'country' variable, 'UK' and 'United Kingdom' should be merged into one category. Similarly, 'USA' and 'United States' should be merged into one category. Let's combine these categories for each country.
  
```{r}
table(df$country)
df$country[df$country == "UK"] <- "United Kingdom"
df$country[df$country == "USA"] <- "United States"
table(df$country)

```
  * For 'age' variable, multiple categories need to be consolidated:   
    - the group '19', '21' should be consolidated into '18-24'.
    - the group '26', '28' should be consolidated into '25-34'.
    - the group '39', '42' should be consolidated into '35-44'.
    - the group '48' should be consolidated into '45-54'.
    
```{r}
table(df$age, useNA = "always")

df$age[df$age == "19"] <- "18-24"
df$age[df$age == "21"] <- "18-24"
df$age[df$age == "26"] <- "25-34"
df$age[df$age == "28"] <- "25-34"
df$age[df$age == "39"] <- "35-44"
df$age[df$age == "42"] <- "35-44"
df$age[df$age == "48"] <- "45-54"


```
  * For 'race' variable, "Black or African American" & "Black or African Americans" should be mergedinto one group.
  
```{r}
table(df$race, useNA = "always")
df$race[df$race == "Black or African Americans"] <- "Black or African American"
```
  * For 'gender' variable, these groups below need to be consolidated:
    -Consolidate "Male" & "Man" into one group
    -Consolidate "Female" & "Woman" into one group
    
```{r}
table(df$gender, useNA = "always")
df$gender[df$gender == "Man"] <- "Male"
df$gender[df$gender == "Woman"] <- "Female"

```
  * 40.2% of race variable's observations (1067) are missing. Let's see if the values in this variable has patterns. 
    
      Based on the contingency table below, 
      - 101/101 employees in Australia have no information about their race. 
      - 60/84 employees in Canada have no information about their race except 24 who are white.
      - 55/60 employees in China have no information about their race except 5 who are white.
      - 24/24 employees in Denmark have no information about their race.
      - 136/136 employees in France have no information about their race.
      - 48/48 employees in Germany have no information about their race. 
      - 288/288 employees in India have no information about their race. 
      - 355/359 employees in the United Kingdom have no information about their race.
      - 1017/1017 employees in the United States have demographic information about race. 

Except for the United States, all the countries with missing information about race are largely ethnically homogeneous (e.g., Denmark). Therefore, the company might not collect information about employee's race as the variance in race among employees might be too small to be a meaningful (For example, according to demographic research, about 90.2 percent of the population in Australia are white). Therefore, conducting an analysis about race for other countries except for the United States would not provide meaningful insights to Hooli.  
```{r}
c_t <- table(df$race, df$country, useNA = "always")
c_t
```

    * 38.7% of 'hiredate' variable's observations (n = 1025) are missing. 
      - Canada is missing 48/84 employees' hiredates
      - China is missing 60/60 employees' hiredates 
      - United States is missing 917/1551 employees' hiredates
      - In total, 1025/2651 employees' hire dates are missing. 
      - The insights I will generate about each tenure group would be limited to provide insights into employees in particularly Canada and China. 

Based on the missing value graph and the contingency tables between 'hireyear' and each demographic predictor (such as country), the pattern of missing values for 'hiredate' appears to be random. Research suggests that when the pattern of missing values is completely random, omitting them does not introduce bias into statistical results. Currently, we have data for about 61% of employees' hire dates, which seems randomly distributed. Given that our goal is to understand the entire employee population, having data for 61% of the population is acceptable, though having nearly 100% of the data would be preferable.
          
```{r}
df_2 <- subset(df, select = c(hiredate, race))
library(Amelia)
missmap(df_2)
rm(df_2)

#the earliest & latest date for hiredate
min(df$hiredate, na.rm = TRUE) # 2014-01-05
max(df$hiredate, na.rm = TRUE) # 2024-11-02


#let's create a new variable named hireyear 
df$hireyear <- format(df$hiredate, "%Y")
table(df$hireyear, useNA = "always") #about 39% of employee hiredates are missing.
library(ggplot2)
ggplot(df, aes(x=hireyear)) + geom_bar()
ggplot(df, aes(x=hiredate)) + geom_histogram() #based on the hiredates, this company grew rapidly between 2022-2023 and hired a bunch!

##Let's identify any patterns that might exist between hireyear (hiredate) or another variable.##
#Let's create a contingency table for hireyear and country 
c_t <- table(df$hireyear, df$country, useNA = "always")
addmargins(c_t)
  ## Canada is missing 45/84 employees' hiredates
  ## China is missing 60/60 employees' hiredates 
  ## United States is missing 927/1551 employees' hiredates
  ## In total, 1032/2651 employees' hire dates are missing. 
  ## I need to be careful about creating tenure groups for Canada, China, and the United States as these groups have a significant missing data issue (roughly 39% of missing data for tenure for Hooli Overall)


#Let's create a contingency table for hireyear and age
table(df$age, useNA = "always")
c_t <- table(df$hireyear, df$age, useNA = "always")
addmargins(c_t)
  ## 59/149 is missing for 18-24 old = 40%
  ## 480/1269 is missing for 25-34 old = 38%
  ## 296/797 is missing for 35-44 years old = 37%
  ## 143/302 is missing for 45-54 = 47%
  ## 44/78 is missing for 55-64 = 56%
  ## 9/54 is missing for 65+ = 17%
  ## 2 individuals have no age data.

#hireyear & manager status

table(df$manager_status, useNA = "always") # manager missing for hire_date = 271/654 = 41 %
c_t <- table(df$hireyear, df$manager_status, useNA = "always") # non-manager missing for hire_date = 761/1997 = 38%
addmargins(c_t)

#hireyear & gender

table(df$gender, useNA = "always") # female missing for hire_date = 318/820 = 39 %
c_t <- table(df$hireyear, df$gender, useNA = "always") # male missing for hire_date = 713/1830 = 39%
addmargins(c_t)

#hireyear & race
table(df$race, useNA = "always") 
c_t <- table(df$hireyear, df$race, useNA = "always") # no particular pattern of missing hiring dates based on race
addmargins(c_t)

```
   * Create a new variable called 'tenure' by using hiredate.
      
      Substract 'hiredate' from March 1st 2024, the date instructed by the technical assessment rubric to create different tenure groups by using 'hiredate'. It's important to note that there are 11 employees who were hired on or after March 1st 2024. However, given that I am asked to analyze the data as of March 1st 2024, I omit these 11 observations to not introduce a bias in my data. For example, introducing this 11 observations into under 3 months might change the characteristics of those in that group as of March 1st 2024. 
      
      - Given that there are only 4 employees in '10+ years' groups, we do not report any findings about this group.
      
```{r}
# the number of employees who were hired on or after March 1st, 2024
participants_count <- sum(!is.na(df$hiredate) & df$hiredate >= as.Date("2024-03-01"))
participants_count

df2 <- df
df2$hiredate <- as.Date(df2$hiredate, format = "%Y-%m-%d")  # Adjust the date format as needed
df2 <- df2[!is.na(df2$hiredate), ]

# Subset rows where 'hiredate' is on or after March 1, 2024
subset_df2 <- df2[df2$hiredate >= as.Date("2024-03-01"), ]
subset_df3 <- subset_df2[, c("eeid", "hiredate")]

print(subset_df3) #the list of employees hired on or after March 1, 2024

rm(df2, subset_df, subset_df2, subset_df3)
min(df$hiredate, na.rm = TRUE) # 2014-01-05, the earliest hiring date
max(df$hiredate, na.rm = TRUE) # 2024-11-02, the latest hiring data



#let's create the cutpoint, which is 2024-03-01, to create tenure groups
cutpoint <- as.Date("2024-03-01")
#given that the average number of days in a month is 365/12 = 30.4166666667, 
tenure_days <- as.numeric(difftime(cutpoint, df$hiredate, units = "days"))
tenure_months <- as.numeric(difftime(cutpoint, df$hiredate, units = "days")/(365/12))


#create tenure_groups 
tenure_groups <- cut(tenure_months,
                      breaks = c(-Inf, 0.0000001, 3, 6, 12, 24, 48, 72, 120, Inf),  # In months
                      labels = c("hired on or after 2024-03-01",  "Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years", "10+ years"), right = FALSE) # right = FALSE to EXCLUDE the right side month in the cateogry

#the distribution of employees in each tenure group
table(tenure_groups, useNA = "always")
# Add tenure_group variable to data frame
df$tenure_group <- as.character(tenure_groups)

# Print the data frame with the new tenure_group variable
table(df$tenure_group, useNA = "always")

```

  * Changing all the missing values to NA (I named this new dataset df_2) to make sure that '-1' does not influence the results of our analysis. 
  
```{r}

df_2 <- df

df_2$ali_1[df_2$ali_1 == -1] <- NA 
df_2$ali_2[df_2$ali_2 == -1] <- NA
df_2$ali_3[df_2$ali_3 == -1] <- NA

df_2$col_1[df_2$col_1 == -1] <- NA 
df_2$col_2[df_2$col_2 == -1] <- NA 
df_2$col_3[df_2$col_3 == -1] <- NA 

df_2$eng_1[df_2$eng_1 == -1] <- NA 
df_2$eng_2[df_2$eng_2 == -1] <- NA
df_2$eng_3[df_2$eng_3 == -1] <- NA 
df_2$eng_4[df_2$eng_4 == -1] <- NA
df_2$eng_5[df_2$eng_5 == -1] <- NA

df_2$inc_1[df_2$inc_1 == -1] <- NA 
df_2$inc_2[df_2$inc_2 == -1] <- NA
df_2$inc_3[df_2$inc_3 == -1] <- NA
df_2$inc_4[df_2$inc_4 == -1] <- NA
df_2$inc_5[df_2$inc_5 == -1] <- NA 

df_2$lea_1[df_2$lea_1 == -1] <- NA
df_2$lea_2[df_2$lea_2 == -1] <- NA
df_2$lea_3[df_2$lea_3 == -1] <- NA
df_2$lea_4[df_2$lea_4 == -1] <- NA

df_2$age[df_2$age == "N/A"] <- NA

#we convert "Unknown" to NA as this category has less than 5 people and we do not report.
df_2$gender[df_2$gender == "Unknown"] <- NA

dfSummary(df_2)

#the end of data-processing & preparation for analysis
```
  
  
  # 2. Data Analysis
  
  * (1) Calculate the favorable scores for all questions and factors for Hooli Overall.
    - a. The favorability scores for all questions below:
```{r}
dfSummary(df_2)
favorability_ali_1 <- sum(df_2$ali_1 %in% c(4,5))/sum(df_2$ali_1 %in% c(1:5))
favorability_ali_1

#let's create a function that automatates the process of calculating favorability scores for all questions at once:

function_favorability <- function(df) {
  favorability_score <- numeric(ncol(df))  # Include all columns
  column_names <- names(df)  # Get the column names
  
  for (i in 1:ncol(df)) {  # Start from column 1
    # Calculate the proportion
    favorability_score[i] <- sum(df[[i]] %in% c(4,5)) / sum(df[[i]] %in% c(1:5))
  }
  
  # Combine favorability scores and column names into a data frame
  result <- data.frame(column_name = column_names, favorability_score = favorability_score)
  
  return(result)
}

# Calculate favorability_score for columns 2 to 21
favorability_score <- function_favorability(df_2[, 2:21])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  
print(favorability_score_percent)
library(ggplot2)

ggplot(favorability_score_percent, aes(x = question_number, y = favorability_score, fill = question_number)) +
  geom_bar(stat = "identity", show.legend = FALSE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorability Score for Each Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)

```
      - b. Calculate a 'Factor Favorable Score', which is the average favorable score among questions within a factor, for each factor.
```{r}
#let's create a function that automates the process of calculating of factor favorable score.

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100
  
print(factor_favorability_score_percent)

#combine the table with favorability score for each item with the table with favorability score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

# Distinguish the average rows from other item rows
highlight_questions <- combined_favorability_df$question_number[c(1, 5, 9, 15, 21)]

combined_favorability_df$highlight <- ifelse(
  combined_favorability_df$question_number %in% highlight_questions,
  "first",
  "other"
)

ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) + 
  labs(x = "Factor", y = "Favorability Score", title = "Favorability Score for Each Factor") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)


#create a df storing each group's enagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "All",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure
```
  * 2. Calculate engagement factor scores by all tenure groups (need to clarify this question..)
    - a. engagement factor favorable scores for employees whose tenure are "Under 3 Months".
      n = 47
```{r}
df_2[df_2$tenure_group == "Under 3 months" & !is.na(df_2$tenure_group), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$tenure_group == "Under 3 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those under 3 months
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with Under 3 Months Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)



#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "Under 3 Months"

```
  
    - b.engagement factor favorability scores for employees whose tenure are "6-12 months".
      n = 290
```{r}
#6-12 months
df_2[df_2$tenure_group == "6-12 months" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "6-12 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 6-12 months tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with 6-12 Months Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)

#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "6-12 Months"
```  
   
    - c. engagement factor favorability scores for employees whose tenure are "1-2 years".
      N = 429
```{r}
#1-2 years
df_2[df_2$tenure_group == "1-2 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "1-2 years", 8:12])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 1-2 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with 1-2 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)

#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "1-2 Years"

```  


    - d. engagement factor favorability scores for employees whose tenure are "2-4 years".
      n = 380
```{r}
#2-4 years
df_2[df_2$tenure_group == "2-4 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "2-4 years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 2-4 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with 2-4 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)
   
   
#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "2-4 Years"

```
    - e. engagement factor scores for employees whose tenure are "4-6 years".
      N = 154
```{r}
#4-6 years
df_2[df_2$tenure_group == "4-6 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "4-6 years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 4-6 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with 4-6 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "4-6 Years"

```
     - f. engagement factor scores for employees whose tenure are "6-10 years".
       N = 29
```{r}
#6-10 years
df_2[df_2$tenure_group == "6-10 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "6-10 years", 8:12])


colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 6-10 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with 6-10 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "6-10 Years"

```
   - g. engagement factor scores for employees whose tenure are "10+ years".
    N = 4, given that this cateogry has less than 4 employees, we don't report it.
```{r}
#10+ years
df_2[df_2$tenure_group == "10+ years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "10+ years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with over 10 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with Over 10 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)
```
   - h. engagement factor scores for employees whose tenure are "hired on or after 2022-08-01".
     N = 55 (wait for what Vivian says)
```{r}
#hired on or after 2022-08-01 
df_2[df_2$tenure_group == "hired on or after 2022-08-01" & !is.na(df_2$tenure_group), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "hired on or after 2022-08-01", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those who were hired on or after 2020-08-01
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees Hired On Or After 2020-08-01") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)

```
  
  - i. Engagement factor favorability scores for employees by tenure
```{r}
engagement_by_tenure$favorability_score <- round(engagement_by_tenure$favorability_score*100)
engagement_by_tenure$question_number <- factor(engagement_by_tenure$question_number, levels = engagement_by_tenure$question_number)
# Distinguish the average row from other item rows
engagement_by_tenure$highlight <- ifelse(engagement_by_tenure$question_number == engagement_by_tenure$question_number[1], "first", "other")


ggplot(engagement_by_tenure, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorability Scores by Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)
```
  
  * 3. Calculate favorable scores for all questions and factors by gender
    - a. favorable scores for all questions for female
        - N for female = 820
```{r}
table(df_2$gender)
df_2[df_2$gender== "Female" & !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$gender == "Female", 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)
```
    - b. factor favorable scores for all factors for female
        - N for female = 820
```{r}
## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```
    - c. favorable scores for all questions for male
        N for male = 1830
```{r}
# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$gender == "Male", 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)
```
  
    - d. favorable scores for all questions by male
         N for male = 1830
```{r}
## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```

  * 4. Correlate all non-engagement questions to the engagement factor for Hooli Overall.

```{r}

# create a new variable named 'engagement_factor', which represents each employee's average of engagement scores. 
df_2$engagement_factor <- rowMeans(df_2[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)


numeric_df_2 <- Filter(is.numeric, df_2)

library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))

correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
correlation_matrix

library(corrplot)
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract the correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),  # Variable names
  correlation = engagement_correlations  # Correlation values
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

engagement_factor_correlation_table <-  engagement_factor_correlation_table %>%
  arrange(desc(correlation))
print(engagement_factor_correlation_table)


library(ggplot2)
ggplot(engagement_factor_correlation_table, aes(x = variable, y = correlation)) +
  geom_bar(alpha = 0.5, stat = "identity", fill = "purple") +  
  labs(x = "variable name", y = "Correlation", title = "Correlations with Engagement Factor") +
  theme( axis.text.x = element_text(size = 9, angle = 45, hjust = 1),
      axis.title = element_text(size = 12),
      plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
    )



regression_model <- lm(engagement_factor ~., data = numeric_df_2)
# Display summary statistics for the model
summary(regression_model)
```
  
  
  * 5. Calculate engagement & leadership factor scores for all countries.
    - a. Australia's N = 101
   

```{r}
df_2[df_2$country == "Australia" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Australia", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```
    - b. Canada's N = 84
```{r}
df_2[df_2$country == "Canada" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Canada", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```
    - c. China's N = 60
```{r}
df_2[df_2$country == "China" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "China", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```
    - d. Denmark's N = 24
```{r}
df_2[df_2$country == "Denmark" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Denmark", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```
    - e. France's N = 136
```{r}
df_2[df_2$country == "France" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "France", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```  
    - f. Germany's N = 48

```{r}
df_2[df_2$country == "Germany" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Germany", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```

    - g. India's N = 288
    
```{r}

df_2[df_2$country == "India" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "India", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

```

    - h. United Kingdom's N = 359
    
```{r}
df_2[df_2$country == "United Kingdom" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "United Kingdom", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)
```
     