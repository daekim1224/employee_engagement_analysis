---
title: "Employee Engagement Analysis for Hooli"
author: "Daehyeon (Dae) Kim"
date: "2024-04-25"
output:
  html_document: 
    theme: cerulean
    df_print: paged
    code_folding: hide
    number_sections: true
    fig_width: 10
    fig_height: 4.5
    fig_caption: true
    toc: true
    toc_depth: 4
    toc_float: true
    
  github_document:
    default: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```
<br>
<br>

# OVERVIEW OF THIS DOCUMENT

<br>
<br>

This document shows my R codes that I used to prepare and analyze Hooli's employee survey data. Please use the table of content on the left side of this document to navigate the document. If you click "Show" button in each section, you can see my codes. The document is structured as follows: <br>

* 1. Overview of this document 

* 2. Data preparation & processing for analysis 

* 3. Data Analysis 

    - 3.1 Calculate the favorable scores for all questions and factors for Hooli overall 
    - 3.2 Calculate engagement factor (favorable) scores for all tenure groups 
    - 3.3 Calculate favorable scores for all questions and factors by gender 
    - 3.4 Correlate all on-engagement questions to the engagement factor for Hooli overall 
    - 3.5 Calculate engagement & leadership factor (favorable) scores for all countries 
    - 3.6 Demographic Composition of the Company 

<br>
<br>

# DATA PREPARATION & PROCESSING FOR ANALYSIS  

<br>
<br>

## Loading Data
```{r}

#check and install required packages to successfully run this rmd

required_packages <- c(
  "tidyselect", "xfun", "corrplot", "pander", "reshape2", "purrr", "tcltk", "colorspace",
  "vctrs", "summarytools", "generics", "htmltools", "yaml", "grDevices", "base64enc", "utf8",
  "rlang", "pillar", "foreign", "glue", "withr", "pryr", "readxl", "matrixStats",
  "lifecycle", "plyr", "NCmisc", "stringr", "munsell", "gtable", "cellranger", "codetools",
  "evaluate", "labeling", "knitr", "fastmap", "fansi", "methods", "Rcpp", "backports",
  "scales", "checkmate", "magick", "farver", "rapportools", "ggplot2", "stats", "datasets",
  "graphics", "digest", "stringi", "dplyr", "grid", "cli", "tools", "magrittr",
  "tibble", "Amelia", "tidyr", "pkgconfig", "MASS", "utils", "timechange", "lubridate",
  "rmarkdown", "base", "rstudioapi", "R6", "compiler"
)

for (pkg in required_packages) {
  if (!(pkg %in% installed.packages())) {
    install.packages(pkg, dependencies = TRUE)
  }
}

#load the data

library(readxl)
df_original <- read_xlsx("data/sr._people_science_analyst_assignment_dataset_2024.xlsx")
```
<br>
<br>

## Data Exploration & Preparation

<br>
<br>

### Examining the macro features of the data

<br>

I first check the macro features of this df to make sure that everything is correct. 

<br>
    
#### transforming 'lea_3' into a numeric variable

<br>

'lea_3' should be a numeric variable. After checking the data, employee ID M01562's response is only missing for'lea_3'. Therefore, this 'N/A' should be recoded as -1. 

<br>
  
#### transforming'hiredate' into a date variable

<br>
    
'hiredate' should be a date variable. It is also important to note that each country follows a different date format (it's a good practice to check the data in Excel before loading in into R to prevent such a mistake). So, in converting this variable to date-type, I need to specify this format in my code. 
      
      - Australia: Day/Month/Year
      - Denmark: Day/Month/Year
      - France: Day/Month/Year
      - Germany: Day/Month/Year
      - India: Day/Month/Year
      - UK: Day/Month/Year
      - United Kingdom: Day/Month/Year
      - United States: Month/Day/Year
      - USA: Month/Day/Year
      - Canada: Month/Day/Year
      - China: Year/Month/Day

<br>
<br>

```{r}
# checking the macro-level trends of the dataset 

head(df_original, 5)
tail(df_original, 5)
str(df_original)

library(Amelia)
missmap(df_original, main = 'missing data map for the Hooli Survey Data', col = c('purple', 'black'), legend = TRUE)

# except for race, most values are not missing!

# Creating a new df that for data preparation & processing for analysis while preserving the original df

df <- df_original 

# Fixing errors in 'lea_3'

table(df_original$lea_3)
df[df$lea_3 == "N/A", ]
df$lea_3[df$lea_3 == "N/A"] <- -1
table(df$lea_3)

#transforming 'lea_3' to a numeric variable
df$lea_3 <- as.numeric(df$lea_3)

#transforming hiredate into a date variable using different date formats for different countries
library(dplyr)

df <- df %>%
  mutate(hiredate = case_when(
    country %in% c("Australia", "Denmark", "France", "Germany", "India", "UK", "United Kingdom") ~ as.Date(hiredate, format = "%d/%m/%Y"),
    country %in% c("United States", "USA", "Canada") ~ as.Date(hiredate, format = "%m/%d/%Y"),
    country == "China" ~ as.Date(hiredate, format = "%Y/%m/%d"),
    TRUE ~ as.Date(NA)  
  ))

library(summarytools)
dfSummary(df$hiredate)

```
<br>
<br>

#### Handling outliers, '99', in various variables

<br>

I identified several outliers, value '99', from the following variables: ali_1, ali_2, ali_3, col_1, col_2, col_3, and lea_4. The value '99' is a value that is out of the scale of -1 to 5. I discovered that all these responses come from Denmark. Thus, it was probably a systematic coding error for these responses from Denmark. Given that these are psychological measures, it doesn't make sense code 99 might denote an exceptional response out of -1 to 5 scale. Thus, I deem 99 as a coding error. Additionally, these employees are less than 1% of the participants in the data and that they completed all the other questions in the survey. Therefore, I recode 99 to -1, the code for missing value. 

<br>

```{r}
library(summarytools)
dfSummary(df)

# examine the responses of the employees who responded '99' to one of these questions.
df[df$ali_1 == 99, ] # other responses are in the normal scale range & 2 participants = M00238 & M00568
df[df$ali_2 == 99, ] # except for ali_2 & lea_4, all the other responses are in the normal scale range & 1 participant = M01455
df[df$ali_3 == 99, ] # other responses are in the normal scale range & 1 participant = M02319
df[df$col_1 == 99, ] # other responses are in the normal scale range & 2 participants = M01339, M01843
df[df$col_2 == 99, ] # other responses are in the normal scale range & 1 participant = M00168
df[df$col_3 == 99, ] # other responses are in the normal scale range & 1 participant = M01393
df[df$lea_3 == 99, ] # except fo lea_3, all the other responses are in the normal scale range & 1 participant = M01484
df[df$lea_4 == 99, ] # except for ali_2 & lea_4, all the other responses are in the normal scale range & 1 participant = M01455

# recode values with 99 to -1.

df$ali_1[df$ali_1 == 99] <- -1
df$ali_2[df$ali_2 == 99] <- -1
df$ali_3[df$ali_3 == 99] <- -1
df$col_1[df$col_1 == 99] <- -1
df$col_2[df$col_2 == 99] <- -1
df$col_3[df$col_3 == 99] <- -1
df$lea_3[df$lea_3 == 99] <- -1
df$lea_4[df$lea_4 == 99] <- -1

```

<br>

#### Handling missing values
<br>

col_1, eng_2, inc_2, & inc_5 have 1 missing value each. It should be correctly coded as -1, the correct code for missing values.

<br>

```{r}
df[is.na(df$col_1), ] #for employee_ID M02429, only col_1 is missing. It should be coded as -1. 
df[is.na(df$eng_2), ] #for employee_ID M01597, only eng_2 is missing. It should be coded as -1.
df[is.na(df$inc_2), ] #for employee_ID M01481, only inc_2 is missing. It should be coded as -1.
df[is.na(df$inc_5), ] #for employee_ID M01722, only inc_5 is missing. It should be coded as -1. 

df$col_1[is.na(df$col_1)] <- -1
df$eng_2[is.na(df$eng_2)] <- -1
df$inc_2[is.na(df$inc_2)] <- -1
df$inc_5[is.na(df$inc_5)] <- -1

```
<br>

#### Checking for duplicates

<br>

there are no duplicates based on employee ID. each response comes from a unique employee.
  
```{r}
sum(duplicated(df$eeid))
```
<br>

#### fixing groups in 'country' variable

<br>

For the 'country' variable, 'UK' and 'United Kingdom' should be merged into one category. Similarly, 'USA' and 'United States' should be merged into one category. Let's combine these categories for each country.
  
```{r}
table(df$country)
df$country[df$country == "UK"] <- "United Kingdom"
df$country[df$country == "USA"] <- "United States"
table(df$country)

```
<br>

#### consolidating 'age' variable's categories   

<br>
* the group '19', '21' should be consolidated into '18-24'.
* the group '26', '28' should be consolidated into '25-34'.
* the group '39', '42' should be consolidated into '35-44'.
* the group '48' should be consolidated into '45-54'.

<br>

```{r}
table(df$age, useNA = "always")

df$age[df$age == "19"] <- "18-24"
df$age[df$age == "21"] <- "18-24"
df$age[df$age == "26"] <- "25-34"
df$age[df$age == "28"] <- "25-34"
df$age[df$age == "39"] <- "35-44"
df$age[df$age == "42"] <- "35-44"
df$age[df$age == "48"] <- "45-54"


```
<br>

#### correctly consolidating 'race' variable's categories

<br>

For 'race' variable, "Black or African American" & "Black or African Americans" should be merged into one group.
  
```{r}
table(df$race, useNA = "always")
df$race[df$race == "Black or African Americans"] <- "Black or African American"
```
<br>

#### correctly consolidating 'gender' variable's categories

<br>

For 'gender' variable, these groups below need to be consolidated:
    * Consolidate "Male" & "Man" into one group
    * Consolidate "Female" & "Woman" into one group
    
```{r}
table(df$gender, useNA = "always")
df$gender[df$gender == "Man"] <- "Male"
df$gender[df$gender == "Woman"] <- "Female"

```
<br>

#### examining race variable's missing observations 

<br>
      Based on the contingency table below, 40.2% of race's variable's observations are missing: 
<br>

* 101/101 employees in Australia have no information about their race. 
* 60/84 employees in Canada have no information about their race except 24 who are white.
* 55/60 employees in China have no information about their race except 5 who are white.
* 24/24 employees in Denmark have no information about their race.
* 136/136 employees in France have no information about their race.
* 48/48 employees in Germany have no information about their race. 
* 288/288 employees in India have no information about their race. 
* 355/359 employees in the United Kingdom have no information about their race.
* 1017/1017 employees in the United States have demographic information about race. 

<br>
<br>
  Except for the United States, all the countries with missing information about race are largely ethnically homogeneous (e.g., Denmark). Therefore, the company might not collect information about employee's race as the variance in race among employees might be too small to be a meaningful (For example, according to demographic research, about 90.2 percent of the population in Australia are white). Therefore, conducting an analysis about race for other countries except for the United States would not provide meaningful insights to Hooli.  

<br>
```{r}
c_t <- table(df$race, df$country, useNA = "always")
c_t
```

<br>

#### Examining 'hiredate' variable. 

<br>
None of the observations are missing.
<br>
```{r}
df_2 <- subset(df, select = c(hiredate))
library(Amelia)
missmap(df_2)
rm(df_2)

#the earliest & latest date for hiredate
min(df$hiredate, na.rm = TRUE) # 2014-12-24
max(df$hiredate, na.rm = TRUE) # 2024-02-29


#let's create a new variable named hireyear 
df$hireyear <- format(df$hiredate, "%Y")
table(df$hireyear, useNA = "always")
library(ggplot2)
ggplot(df, aes(x=hireyear)) + geom_bar()
ggplot(df, aes(x=hiredate)) + geom_histogram() #this company hired employees a ton in 2022!!


```
<br>

#### creating a new variable called 'tenure' by using hiredate

<br>

Substract 'hiredate' from March 1st 2024, the date instructed by the technical assessment rubric to create different tenure groups by using 'hiredate'.Given that there are only 4 employees in '10+ years' groups, we do not report any findings about this group as the reporting minimum is 5 per group.

<br>            
```{r}
#let's create the cutpoint, which is 2024-03-01, to create tenure groups
cutpoint <- as.Date("2024-03-01")
#given that the average number of days in a month is 365/12 = 30.4166666667, 
tenure_days <- as.numeric(difftime(cutpoint, df$hiredate, units = "days"))
tenure_months <- as.numeric(difftime(cutpoint, df$hiredate, units = "days")/(365/12))

#create tenure_groups 
tenure_groups <- cut(tenure_months,
                      breaks = c(0, 3, 6, 12, 24, 48, 72, 120, Inf),  # In months
                      labels = c("Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years", "10+ years"), right = FALSE) # right = FALSE to EXCLUDE the right side month in the cateogry

#the distribution of employees in each tenure group
table(tenure_groups, useNA = "always")
# Add tenure_group variable to data frame
df$tenure_group <- as.character(tenure_groups)

# Print the data frame with the new tenure_group variable
table(df$tenure_group, useNA = "always")

```

<br>

#### recoding -1 (missing values) to NA

<br>
I changed all the missing values (-1) to NA (I named this new dataset df_2) to make sure that '-1' does not influence the results of our analysis. 

<br>
```{r}

df_2 <- df

df_2$ali_1[df_2$ali_1 == -1] <- NA 
df_2$ali_2[df_2$ali_2 == -1] <- NA
df_2$ali_3[df_2$ali_3 == -1] <- NA

df_2$col_1[df_2$col_1 == -1] <- NA 
df_2$col_2[df_2$col_2 == -1] <- NA 
df_2$col_3[df_2$col_3 == -1] <- NA 

df_2$eng_1[df_2$eng_1 == -1] <- NA 
df_2$eng_2[df_2$eng_2 == -1] <- NA
df_2$eng_3[df_2$eng_3 == -1] <- NA 
df_2$eng_4[df_2$eng_4 == -1] <- NA
df_2$eng_5[df_2$eng_5 == -1] <- NA

df_2$inc_1[df_2$inc_1 == -1] <- NA 
df_2$inc_2[df_2$inc_2 == -1] <- NA
df_2$inc_3[df_2$inc_3 == -1] <- NA
df_2$inc_4[df_2$inc_4 == -1] <- NA
df_2$inc_5[df_2$inc_5 == -1] <- NA 

df_2$lea_1[df_2$lea_1 == -1] <- NA
df_2$lea_2[df_2$lea_2 == -1] <- NA
df_2$lea_3[df_2$lea_3 == -1] <- NA
df_2$lea_4[df_2$lea_4 == -1] <- NA

df_2$age[df_2$age == "N/A"] <- NA

#we convert "Unknown" to NA as this category has less than 5 people and we do not report.
df_2$gender[df_2$gender == "Unknown"] <- NA

dfSummary(df_2)

#the end of data-processing & preparation for analysis
```
<br>
<br>

# DATA ANALYSIS

<br>
<br>

## Calculate the Favorable Scores for Qll Questions and Factors for Hooli Overall.
<br>
<br>

### Calculating the favorable scores for all questions
<br>
<br>
Favorable scores are defined as the sum of the number of answers that are agree and strongly agree over the number of all non missing responses. 
<br>
<br>
```{r}
#let's create a function that automates the process of calculating favorable scores for all questions at once:

function_favorability <- function(df) {
  favorability_score <- numeric(ncol(df))  # Include all columns
  column_names <- names(df)  # Get the column names
  
  for (i in 1:ncol(df)) {  # Start from column 1
    # Calculate the proportion
    favorability_score[i] <- sum(df[[i]] %in% c(4,5)) / sum(df[[i]] %in% c(1:5))
  }
  
  # Combine favorability scores and column names into a data frame
  result <- data.frame(column_name = column_names, favorability_score = favorability_score)
  
  return(result)
}

# Calculate favorability_score for columns 2 to 21
favorability_score <- function_favorability(df_2[, 2:21])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  
print(favorability_score_percent)


#graph favorable score for each question
##setting different colors for different factors

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")

##

group_colors <- c(
  "Alignment" = "#D08770",  # Light orange for Group 1
  "Collaboration" = "#A3BE8C",  # Light green for Group 2
  "Engagement" = "#5E81AC",  # Light blue for Group 3
  "Inclusion" = "#EBCB8B",  # Light yellow for Group 4
  "Leadership" = "#B48EAD"   # Mild purple for Group 5
)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars
```
<br>
<br>

### Calculating a 'factor favorable score', which is the average favorable score among questions within the same factor, for each factor
<br>
<br>

```{r}
#let's create a function that automates the process of calculating of factor favorable score.

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors (vertical)
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores (vertical)

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's enagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Overall",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



#create a graph that shows enagement favorable score across tenure groups (all)

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

#Desired order of question_number in reverse as I am making a horizontal graph
desired_order <- c("eng_5", "eng_4", "eng_3", "eng_2", "eng_1", "eng")

#Set the factor levels in reverse order
engagement_favorable_score_for_all$question_number <- factor(
  engagement_favorable_score_for_all$question_number,
  levels = (desired_order)  # Reverse the desired order
)

#Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

#Color palette for highlighting
highlight_colors <- c("first" = "#9A36B2",  # Purple for the 'first' category
                      "other" = "#C9A5DD")  # light purple for the 'other' category

#Create a horizontal bar plot with ggplot
ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) + 
  coord_flip() +  
  labs(
    x = "Factor Items",  
    y = "Favorability Score", 
    title = "Engagement Factor Favorable Scores",
    caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses. Factor favorability score is an average of all the items for the factor."  # Add the caption
  ) +
  theme_minimal() + 
  theme(
    axis.text.y = element_text(size = 12),  
    axis.text.x = element_text(size = 12), 
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),  
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14),
  plot.caption = element_text(size = 6, hjust = 0)  
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), 
            hjust = -0.3,  
            size = 4) +  
  scale_fill_manual(values = highlight_colors)  


```
<br>
<br>

## Calculate Engagement Factor (Favorable) Scores by All Tenure Groups
<br>
<br>

### Engagement factor favorable scores for employees whose tenure are "Under 3 Months"

<br>
<br>

n = 64

```{r}

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$tenure_group == "Under 3 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those under 3 months
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # Purple for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with Under 3 Months Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "Under 3 Months"

```
<br>
<br>

### Engagement factor favorability scores for employees whose tenure are "3-6 months"
      
<br>
<br>
n = 325
```{r}
#3-6 months
df_2[df_2$tenure_group == "3-6 months" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "3-6 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 3-6 months tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)

average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

# graph showing engagement factor scores for the 3-6 months tenure group

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 3-6 Months Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "3-6 Months"
```  
<br>
<br>

### Engagement factor favorability scores for employees whose tenure are "6-12 months"
      
<br>
<br>

n = 507

```{r}
#6-12 months
df_2[df_2$tenure_group == "6-12 months" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "6-12 months", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 6-12 months tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

# graph showing engagement factor scores for the 6-12 months tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 6-12 Months Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "6-12 Months"
```  
<br>
<br>
  
### Engagement factor favorability scores for employees whose tenure are "1-2 years"

<br>
<br>
    
n= 670
    
```{r}

#1-2 years
df_2[df_2$tenure_group == "1-2 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "1-2 years", 8:12])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 1-2 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 1-2 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 1-2 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "1-2 Years"

```  
<br>
<br>

### Engagement factor favorability scores for employees whose tenure are "2-4 years"
<br>
<br>

n = 644
```{r}
#2-4 years
df_2[df_2$tenure_group == "2-4 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "2-4 years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 2-4 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores




# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 2-4 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 2-4 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
   
   
#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "2-4 Years"

```
<br>
<br>

### Engagement factor scores for employees whose tenure are "4-6 years"

<br>
<br>

n = 274
```{r}
#4-6 years
df_2[df_2$tenure_group == "4-6 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "4-6 years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 4-6 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)

# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 4-6 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 4-6 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
   


#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "4-6 Years"

```
<br>
<br>

### Engagement factor scores for employees whose tenure are "6-10 years"

<br>
<br>
       N = 163
```{r}

#6-10 years
df_2[df_2$tenure_group == "6-10 years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "6-10 years", 8:12])


colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with 6-10 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)



# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")


# graph showing engagement factor scores for the 6-10 years tenure group
ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Employees with 6-10 years Tenure") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

#append this group's engagement factor favorability score to the tenure group df
engagement_by_tenure <- rbind(engagement_by_tenure, average_row)
engagement_by_tenure$question_number[engagement_by_tenure$question_number == "average"] <- "6-10 Years"

```
<br>
<br>

### Engagement factor scores for employees whose tenure are "10+ years"
    
<br>
<br>

n = 4, given that this category has less than 5 employees, we don't report it.
```{r}

#it is critical that there are only 2 employees who have worked longer than 10 years.

#10+ years
df_2[df_2$tenure_group == "10+ years" & !is.na(df_2$tenure_group), ]
# Calculate favorability_score for columns 8 to 12 (engagement questions)
favorability_score <- function_favorability(df_2[df_2$tenure_group == "10+ years", 8:12])

colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate the average engagement factor favorable score for those with over 10 years tenure
average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)


average_row <- data.frame(
  question_number = "average",  
  favorability_score = average_score
)

favorability_score_with_average <- rbind(favorability_score, average_row)
print(favorability_score_with_average)

favorability_score_with_average_percent <- favorability_score_with_average
favorability_score_with_average_percent$favorability_score <- round(favorability_score_with_average_percent $favorability_score,2)*100

print(favorability_score_with_average_percent)
#visualize the favorability scores


# Distinguish the average row from other item rows
favorability_score_with_average_percent$highlight <- ifelse(favorability_score_with_average_percent$question_number == favorability_score_with_average_percent$question_number[6], "first", "other")

ggplot(favorability_score_with_average_percent, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Favorability Scores for Employees with Over 10 Years Tenure") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1), 
    plot.title = element_text(hjust = 0.5)  
  ) +
   geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5)
```
<br>
<br>

### Engagement factor favorable scores across tenure groups (employee life cycle)

<br>
<br>

```{r}
engagement_by_tenure$favorability_score <- round(engagement_by_tenure$favorability_score*100)
engagement_by_tenure$question_number <- factor(engagement_by_tenure$question_number, levels = engagement_by_tenure$question_number)

engagement_by_tenure
# Distinguish the average row from other item rows
engagement_by_tenure$highlight <- ifelse(engagement_by_tenure$question_number == engagement_by_tenure$question_number[1], "first", "other")


# graph showing engagement factor scores across tenure groups 
ggplot(engagement_by_tenure, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores Across Tenure Groups") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 11),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  


```
<br>
<br>
   
### Changes in employee engagement favorable scores over employee life cycle (line graphs)

<br>
<br>
   
```{r}
library(dplyr)
library(ggplot2)
library(scales)

table(df_2$tenure_group)
#List of tenure groups
tenure_groups <- c("Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years")

#Create an empty data frame to store the consolidated results
consolidated_favorability_scores <- data.frame(
  tenure_group = character(),
  question_number = character(),
  favorability_score = numeric(),
  stringsAsFactors = FALSE
)

#Loop through each tenure group and calculate favorability scores
for (group in tenure_groups) {
  #Calculate favorability scores
  favorability_score <- function_favorability(df_2[df_2$tenure_group == group, c(8:12)])  # Example column range
  colnames(favorability_score)[1] <- "question_number"
  
  #Calculate the average favorability score
  average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)
  
  #Create the "average" row
  average_row <- data.frame(
    question_number = "average",  
    favorability_score = average_score
  )
  
  #Add the "average" row to the data frame
  favorability_score <- rbind(favorability_score, average_row)
  
  #Add the tenure group to the data frame
  favorability_score <- favorability_score %>%
    mutate(tenure_group = group)  # Label with the tenure group
  
  #Append to the consolidated data frame
  consolidated_favorability_scores <- rbind(
    consolidated_favorability_scores,
    favorability_score
  )
}

#set the order for tenure grouops in the new df
consolidated_favorability_scores <- consolidated_favorability_scores %>%
  mutate(tenure_group = factor(tenure_group, levels = tenure_groups))  # Set the levels


print(consolidated_favorability_scores)

# line graph showing each engagement factor's change over time
ggplot(consolidated_favorability_scores, aes(x = tenure_group, y = favorability_score * 100, group = question_number, color = question_number)) +
  geom_line(size = 1.2) + 
  geom_point(size = 3) +  
  labs(
    x = "Tenure Group",
    y = "Favorability Score (%)",
    title = "Change in Engagement Favorable Scores Across Employee Lifecycle",
    caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses.", 
    color = "Engagement Questions"  
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
  plot.caption = element_text(size = 6, hjust = 0)    
  ) +
  scale_y_continuous(labels = percent_format(scale = 1))  


#create another line graph in which I emphasize average, eng_4, and eng_5


# Assign colors or line styles to emphasize specific lines
line_colors <- c(
  "average" = "red",  # Emphasize the "average" line with red color
  "eng_4" = "blue",  # Emphasize "eng_4" with blue
  "eng_5" = "orange",  # Emphasize "eng_5" with orange
  "other" = "gray"  # Use a neutral color for other lines
)

# Create a line plot with customized colors for emphasis
ggplot(consolidated_favorability_scores, aes(x = tenure_group, y = favorability_score * 100, group = question_number)) +
  geom_line(aes(color = ifelse(question_number %in% c("average", "eng_4", "eng_5"), question_number, "other")), size = 1.2) +  # Draw lines with custom colors
  geom_point(aes(color = ifelse(question_number %in% c("average", "eng_4", "eng_5"), question_number, "other")), size = 3) +  # Add points with matching colors
  labs(
    x = "Tenure Group",
    y = "Favorability Score (%)",
    title = "Change in Engagement Favorability Scores Across Employee Lifecycle",
    caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses.",  # Detailed caption
    color = "Engagement Questions"  # Custom legend title
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
  plot.caption = element_text(size = 6, hjust = 0)    
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +  # Display y-axis as percentage
  scale_color_manual(values = line_colors)  # Assign specific colors to lines





#Create an empty data frame to store the consolidated results for men and women separately

consolidated_favorability_scores_men <- data.frame(
  tenure_group = character(),
  question_number = character(),
  favorability_score = numeric(),
  stringsAsFactors = FALSE
)

consolidated_favorability_scores_women <- data.frame(
  tenure_group = character(),
  question_number = character(),
  stringsAsFactors = FALSE
)

# Define tenure groups, excluding '10+ years'
tenure_groups <- c("Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years")

# Function to calculate favorability scores and add tenure groups
calculate_scores_by_tenure <- function(data, tenure_groups) {
  consolidated_scores <- data.frame(
    tenure_group = character(),
    question_number = character(),
    favorability_score = numeric(),
    stringsAsFactors = FALSE
  )

  for (group in tenure_groups) {
    # Calculate favorability scores for each tenure group
    favorability_score <- function_favorability(data[data$tenure_group == group, c(8:12)])  # Example column range
    colnames(favorability_score)[1] <- "question_number"
    
    # Calculate the average favorability score
    average_score <- mean(favorability_score$favorability_score, na.rm = TRUE)
    
    # Create the "average" row
    average_row <- data.frame(
      question_number = "average",
      favorability_score = average_score
    )
    
    # Add the "average" row to the data frame
    favorability_score <- rbind(favorability_score, average_row)
    
    # Add the tenure group to the data frame
    favorability_score <- favorability_score %>%
      mutate(tenure_group = group)  # Label with the tenure group
    
    # Append to the consolidated data frame
    consolidated_scores <- rbind(
      consolidated_scores,
      favorability_score
    )
  }

  # Set the order for tenure groups
  consolidated_scores <- consolidated_scores %>%
    mutate(tenure_group = factor(tenure_group, levels = tenure_groups))
  
  return(consolidated_scores)
}

# Calculate scores for men and women, excluding '10+ years'
consolidated_favorability_scores_men <- calculate_scores_by_tenure(df_2[df_2$gender == "Male" & df_2$tenure_group != "10+ years", ], tenure_groups)
consolidated_favorability_scores_women <- calculate_scores_by_tenure(df_2[df_2$gender == "Female" & df_2$tenure_group != "10+ years", ], tenure_groups)

# Now create the line plots for men and women, excluding '10+ years'
# Line plot for men
ggplot(consolidated_favorability_scores_men, aes(x = tenure_group, y = favorability_score * 100, group = question_number, color = question_number)) +
  geom_line(size = 1.2) +  # Draw lines
  geom_point(size = 3) +  # Add points
  labs(
    x = "Tenure Group",
    y = "Favorability Score (%)",
    title = "Change in Engagement Favorability Scores for Men Across Employee Lifecycle",
     caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses.",  # Detailed caption
    color = "Engagement Questions"  # Custom legend title
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 8, hjust = 0)    
  ) +
  scale_y_continuous(labels = percent_format(scale = 1))  # Display y-axis as percentage

# Line plot for men
ggplot(consolidated_favorability_scores_men, aes(x = tenure_group, y = favorability_score * 100, group = question_number, color = question_number)) +
  geom_line(size = 1.2) +  # Draw lines
  geom_point(size = 3) +  # Add points
  labs(
    x = "Tenure Group",
    y = "Favorability Score (%)",
    title = "Change in Engagement Favorability Scores for Men Across Employee Lifecycle",
     caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses.",  # Detailed caption
    color = "Engagement Questions"  # Custom legend title
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 8, hjust = 0)    
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +  # Display y-axis as percentage
  scale_color_manual(values = line_colors)

# Line plot for women
ggplot(consolidated_favorability_scores_women, aes(x = tenure_group, y = favorability_score * 100, group = question_number, color = question_number)) +
  geom_line(size = 1.2) +  # Draw lines
  geom_point(size = 3) +  # Add points
  labs(
    x = "Tenure Group",
    y = "Favorability Score (%)",
    title = "Change in Engagement Favorability Scores for Women Across Employee Lifecycle",
     caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses.",  # Detailed caption
    color = "Engagement Questions"  # Custom legend title
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 8, hjust = 0)    
  ) +
  scale_y_continuous(labels = percent_format(scale = 1))

# Line plot for women
ggplot(consolidated_favorability_scores_women, aes(x = tenure_group, y = favorability_score * 100, group = question_number, color = question_number)) +
  geom_line(size = 1.2) +  # Draw lines
  geom_point(size = 3) +  # Add points
  labs(
    x = "Tenure Group",
    y = "Favorability Score (%)",
    title = "Change in Engagement Favorability Scores for Women Across Employee Lifecycle",
     caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses.",  # Detailed caption
    color = "Engagement Questions"  # Custom legend title
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 8, hjust = 0)    
  ) +
 scale_y_continuous(labels = percent_format(scale = 1)) +  # Display y-axis as percentage
  scale_color_manual(values = line_colors)

```

  
<br>
<br>

## Calculate Favorable Scores for All Questions and Factors by gender
<br>
<br>

### Favorable scores for all questions and factors for women
<br>
<br>
   
N for female = 820
```{r}
table(df_2$gender)
df_2[df_2$gender== "Female" & !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$gender == "Female", 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")


print(favorability_score_percent)


## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")


#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Overall",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


#create a graph that shows engagement favorable score across tenure groups (all)

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

#Create a ggplot that shows engagement factor favorable scores for women

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  

```
    
<br>
<br>

### Favorable scores for all questions and factors for men

<br>
<br>

n = 1830
```{r}
# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$gender == "Male", 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  
print(favorability_score_percent)

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")


print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")


#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores 

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Overall",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


#create a graph that shows engagement favorable score across tenure groups (all)

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

# create a graph that shows engagement factor favorable scores for men 
ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>

### a graph comparing enagement factor favorable scores between men and women

<br>
<br>
```{r}
library(ggplot2)
library(dplyr)

# Calculate engagement favorability scores for all employees
all_employees_favorability_score <- function_favorability(df_2[, 8:12])
all_employees_favorability_score$gender <- "All Employees"  # Label as 'All Employees'

# Calculate engagement favorability scores for men
men_df <- df_2[df_2$gender == "Male", ]
men_favorability_score <- function_favorability(men_df[, 8:12])
men_favorability_score$gender <- "Men"  # Label as 'Men'

# Calculate engagement favorability scores for women
women_df <- df_2[df_2$gender == "Female", ]
women_favorability_score <- function_favorability(women_df[, 8:12])
women_favorability_score$gender = "Women"  # Label as 'Women'

# Combine all the scores into a single data frame
combined_favorability_scores <- rbind(
  all_employees_favorability_score,
  men_favorability_score,
  women_favorability_score
)

# Convert favorability scores to percentages
combined_favorability_scores$favorability_score <- combined_favorability_scores$favorability_score * 100

# Rename the first column to "question_number"
colnames(combined_favorability_scores)[1] = "question_number"

# Create a bar graph with ggplot2
ggplot(combined_favorability_scores, aes(x = question_number, y = favorability_score, fill = gender)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  labs(
    x = "Engagement Question",
    y = "Favorability Score (%)",
    title = "Engagement Favorability Scores by Gender",
    caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all responses."
    )+
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1),  # Rotate x-axis labels
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
  plot.caption = element_text(size = 6, hjust = 0)    # Style the title
  ) +
  geom_text(aes(label = paste0(round(favorability_score, 1), "%")),  # Add percentage labels
            position = position_dodge(width = 0.9),
            vjust = -0.5,
            size = 3.5) +  # Adjust text size
  scale_fill_manual(  # Custom colors for gender
    values = c("Men" = "skyblue", "Women" = "purple", "All Employees" = "gray")
  )
```


<br>
<br>

<br>
<br>
   
### Favorable scores for all questions for women for Under 3 months
<br>
<br>
  
n = 25
```{r}
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "Under 3 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "Under 3 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Under 3 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



#create a graph that shows engagement favorable scores for women with tenure under 3 months  

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure Under 3 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### Favorable scores for all questions for women with tenure between 3-6 months 

<br>
<br>

n = 116
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "3-6 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "3-6 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  

library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")


print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "3-6 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 3-6 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### Favorable scores for all questions for women with tenure between 6-12 months 

<br>
<br>
n = 181
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-12 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-12 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-12 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 6 and 12 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>

### Favorable scores for all questions for women with tenure between 1-2 years 
<br>
<br>
n = 211
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "1-2 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "1-2 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "1-2 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 1-2 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>

### Favorable scores for all questions for women with tenure between 2-4 years 
<br>
<br>
   
n = 191
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "2-4 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "2-4 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "2-4 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 2-4 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>

### Favorable scores for all questions for women with tenure between 4-6 years 
<br>
<br>

n = 58
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "4-6 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "4-6 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100


library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "4-6 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 4-6 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### Favorable scores for all questions for women with tenure between 6-10 years 

<br>
<br>
   
n = 37
   
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-10 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Female" & 
  df_2$tenure_group == "6-10 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Women with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-10 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Women with Tenure between 6-10 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### Favorable scores for all questions for men for Under 3 months

<br>
<br>
   
n = 39
```{r}
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "Under 3 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "Under 3 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)

#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")

#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure under 3 Months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "Under 3 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



#create a graph that shows engagement favorable score across tenure groups 

engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure Under 3 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>

### Favorable scores for all questions for men with tenure between 3-6 months 
<br>
<br>
   
 n = 209
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "3-6 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "3-6 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100


library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 3-6 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "3-6 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure


engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 3-6 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### Favorable scores for all questions for men with tenure between 6-12 months 
<br>
<br>

n = 325
      
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-12 months" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-12 months" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-12 months") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-12 months",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 6 and 12 Months") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### Favorable scores for all questions for men with tenure between 1-2 years 
     
<br>
<br>
 n = 459
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "1-2 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "1-2 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)



#change the factor favorable scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 1-2 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "1-2 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 1-2 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### n. favorable scores for all questions for men with tenure between 2-4 years 

<br>
<br>

n = 453
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "2-4 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "2-4 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100


library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 2-4 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "2-4 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 2-4 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

<br>
<br>
   
### Favorable scores for all questions for men with tenure between 4-6 years 
<br>
<br>
n = 216 
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "4-6 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "4-6 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 4-6 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "4-6 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 4-6 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```

<br>
<br>
   
### Favorable scores for all questions for men with tenure between 6-10 years 

<br>
<br>
n = 126  
```{r}
table(df_2$gender, df_2$tenure_group)
df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-10 years" & 
  !is.na(df_2$gender), ]

# Calculate favorability_score for columns 2 to 21 by using function_favorability I created.
favorability_score <- function_favorability(df_2[
  df_2$gender == "Male" & 
  df_2$tenure_group == "6-10 years" , 2:21])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

favorability_score_percent <- favorability_score 
favorability_score_percent$favorability_score <- round(favorability_score_percent$favorability_score,2)*100
  


library(dplyr)
favorability_score_percent$Factor <- dplyr::case_when(
  favorability_score_percent$question_number %in% c("ali_1", "ali_2", "ali_3") ~ "Alignment",
  favorability_score_percent$question_number %in% c("col_1", "col_2", "col_3") ~ "Collaboration",
  favorability_score_percent$question_number %in% c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5") ~ "Engagement",
  favorability_score_percent$question_number %in% c("inc_1", "inc_2", "inc_3", "inc_4", "inc_5") ~ "Inclusion",
  favorability_score_percent$question_number %in% c("lea_1", "lea_2", "lea_3", "lea_4") ~ "Leadership",
  TRUE ~ "Other")



print(favorability_score_percent)

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(factor_favorable_score,
                                  data.frame(factor_abbreviation = factor_abbr,
                                             factor_favorable_score = avg_favorable_score))
}

print(factor_favorable_score)


#change the favorability scores into percentage 
factor_favorability_score_percent <- factor_favorable_score
factor_favorability_score_percent$factor_favorable_score <- round(factor_favorability_score_percent$factor_favorable_score,2)*100

library(dplyr)
factor_favorability_score_percent$Factor <- dplyr::case_when(
  factor_favorability_score_percent$factor_abbreviation %in% c("ali") ~ "Alignment",
  factor_favorability_score_percent$factor_abbreviation %in% c("col") ~ "Collaboration",
  factor_favorability_score_percent$factor_abbreviation %in% c("eng") ~ "Engagement",
  factor_favorability_score_percent$factor_abbreviation %in% c("inc") ~ "Inclusion",
  factor_favorability_score_percent$factor_abbreviation %in% c("lea") ~ "Leadership",
  TRUE ~ "Other")



#combine the table with favorable score for each item with the table with favorable score for each factor
colnames(factor_favorability_score_percent) <- c("question_number", "favorability_score", "Factor")
combined_favorability_df <- rbind(favorability_score_percent, factor_favorability_score_percent)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

## Create a ggplot bar plot with the preselected colors
library(ggplot2)
ggplot(combined_favorability_df, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars

  
## Create a ggplot bar plot for factor favorable scores

library(ggplot2)
ggplot(factor_favorability_score_percent, aes(x = question_number, y = favorability_score, fill = Factor)) +
  geom_bar(stat = "identity", show.legend = TRUE) + 
  labs(x = "Question Item", y = "Favorability Score", title = "Favorable Score for Each Factor and Question Item for Men with Tenure between 6-10 years") + 
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(hjust = 0.5)
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5) +  # Add text labels to the bars
  scale_fill_manual(values = group_colors)  # Apply custom colors to the bars


#create a df storing each group's engagement factor favorability score gradually.
engagement_by_tenure <- data.frame(
  question_number = "6-10 years",  
  favorability_score = factor_favorable_score$factor_favorable_score[factor_favorable_score$factor_abbreviation == "eng"])

engagement_by_tenure



engagement_favorable_score_for_all <- combined_favorability_df[combined_favorability_df$question_number %in% c("eng", "eng_1", "eng_2", "eng_3", "eng_4", "eng_5"), ]


engagement_favorable_score_for_all

# Distinguish the average row from other item rows
engagement_favorable_score_for_all$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_score_for_all$question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category

ggplot(engagement_favorable_score_for_all, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  labs(x = "Factor Items", y = "Favorability Score", title = "Engagement Factor Favorable Scores for Men with Tenure between 6-10 Years") + 
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(favorability_score, "%")), vjust = -0.5, size = 4) +  
  scale_fill_manual(values = highlight_colors) 
```

<br>
<br>

 
<br>
<br>

## Correlate All Non-Engagement Questions to the Engagement Factor for Hooli Overall.

<br>
<br>

### For all employees & all non-engagement items (Kendall's tau-b & pearson's r)

<br>
<br>
   
The results from the correlations calculated by conducting Kendall's tau-b and pearson's r are largley convergent while kendall's tau-b's results are much more conservative in terms of the size of the correlations. 

```{r}
#Create a new variable named 'engagement_factor', representing the average engagement scores.
df_2$engagement_factor <- rowMeans(df_2[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

#Select only the numeric columns from 'df_2' excluding 'eng_1' to 'eng_5'
numeric_df_2 <- Filter(is.numeric, df_2)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)

# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


library(corrplot)
# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2 %>%
  mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_factor_scores <- subset(composite_scores, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
<br>
<br>
   
### For women only (correlation calculated by conducting kendall's tau-b & Pearson's r)
<br>
<br>
   
```{r}

library(dplyr)

# Subset df_2 to include only female employees
df_2_female <- df_2 %>%
  filter(gender == "Female")

# Calculate the engagement factor for female employees
df_2_female$engagement_factor <- rowMeans(df_2_female[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)


numeric_df_2 <- Filter(is.numeric, df_2_female)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Women", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Women", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )





#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2[df_2$gender == "Female", ] %>%
  mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_factor_scores <- subset(composite_scores, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement for Women", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
<br>
<br>
   
### For men only (correlation calculated by conducting kendall's tau-b & Pearson's r)

<br>
<br>
   
```{r}
library(dplyr)

# Subset df_2 to include only male employees
df_2_male <- df_2 %>%
  filter(gender == "Male")

# Calculate the engagement factor for female employees
df_2_male$engagement_factor <- rowMeans(df_2_male[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

# Display a few rows to check the new variable
head(df_2_male)

numeric_df_2 <- Filter(is.numeric, df_2_male)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Men", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Men", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2[df_2$gender == "Male", ] %>%
  mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_factor_scores <- subset(composite_scores, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement for Men", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
<br>
<br>
   
### For Indian employees (correlation calculated by conducting kendall's tau-b & Pearson's r)
<br>
<br>
   
```{r}
library(dplyr)

# Subset df_2 to include only Indian employees
df_2_india <- df_2 %>%
  filter(country == "India")

# Calculate the engagement factor for female employees
df_2_india$engagement_factor <- rowMeans(df_2_india[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

# Display a few rows to check the new variable
head(df_2_india)

numeric_df_2 <- Filter(is.numeric, df_2_india)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Indian Employees", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Indian Employees", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )



#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2[df_2$country == "India", ] %>%
  mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_factor_scores <- subset(composite_scores, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement for Indian Employees", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
<br>
<br>

### For German employees (correlation calculated by conducting kendall's tau-b & Pearson's r)
<br>
<br>
   
```{r}
library(dplyr)

# Subset df_2 to include only Indian employees
df_2_germany <- df_2 %>%
  filter(country == "Germany")

# Calculate the engagement factor for german employees
df_2_germany$engagement_factor <- rowMeans(df_2_germany[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

# Display a few rows to check the new variable
head(df_2_germany)

numeric_df_2 <- Filter(is.numeric, df_2_germany)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for German Employees", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for German Employees", caption = "Correlations calculated using Pearson's r"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )



#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2[df_2$country == "Germany", ] %>%
  mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_factor_scores <- subset(composite_scores, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement for German Employees", caption = "Correlations calculated using Kendall's tau-b"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )
```
<br>
<br>
   
### For employees who are high on employee_engagement (correlation calculated by conducting kendall's tau-b & Pearson's r)
<br>
<br>

This analysis included survey responses onlyfrom employees whose engagement factor composite score is equal to or greater than 4 only.
   
```{r}
library(dplyr)

# Calculate the engagement factor for employees
df_2$engagement_factor <- rowMeans(df_2[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

hist(df_2$engagement_factor)

high_engagement <- df_2 %>%
  filter(engagement_factor >= 4)

numeric_df_2 <- Filter(is.numeric, high_engagement)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for highly engaging employees", caption = "Correlations calculated using Kendall's tau-b | employees with engagement composite factor score greater than or equal to 4 are only included for analysis"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Highly Engaged Employees", caption = "Correlations calculated using Pearson's r | employees with engagement composite factor score greater than or equal to 4 are only included for analysis"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )



#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2 %>% mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_scores_high <- composite_scores %>%
  filter(Engagement >= 4)

composite_factor_scores <- subset(composite_scores_high, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores_high, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)

#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement for Highly Engaged Employees", caption = "Correlations calculated using Kendall's tau-b | employees with engagement composite factor score greater than or equal to 4 are only included for analysis" 
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
<br>
<br>
   
### For employees who are low on employee_engagement (correlation calculated by conducting kendall's tau-b & Pearson's r)
<br>
<br>
This analysis included survey responses only from those employees whose engagement factor composite score is smaller than or equal to 2. n = 47
   
```{r}
library(dplyr)

# Calculate the engagement factor for employees
df_2$engagement_factor <- rowMeans(df_2[, c("eng_1", "eng_2", "eng_3", "eng_4", "eng_5")], na.rm = TRUE)

hist(df_2$engagement_factor)


low_engagement <- df_2 %>%
  filter(engagement_factor <= 2)

numeric_df_2 <- Filter(is.numeric, low_engagement)
library(dplyr)
numeric_df_2 <- subset(numeric_df_2, select= -c(eng_1, eng_2, eng_3, eng_4, eng_5))


#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(numeric_df_2, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "engagement_factor"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "engagement_factor", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[13:15, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Less Engaged employees", caption = "Correlations calculated using Kendall's tau-b | Only employees with engagement composite factor score lower than or equal to 2 are included for this analysis"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )


# Recreate the Pearson's r correlation matrix to see if they are too divergent
correlation_matrix <- cor(numeric_df_2, use = "complete.obs")
corrplot(correlation_matrix, type = "upper", order = "hclust")

# Extract correlations for "engagement_factor"
engagement_correlations <- correlation_matrix[, "engagement_factor"]

engagement_factor_correlation_table <- data.frame(
  variable = names(engagement_correlations),
  correlation = engagement_correlations
)

engagement_factor_correlation_table <- engagement_factor_correlation_table[
  engagement_factor_correlation_table$variable != "engagement_factor", 
]

# Sort in descending order to get the strongest correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table %>%
  arrange(correlation)

# Keep only the top 3 correlations
engagement_factor_correlation_table <- engagement_factor_correlation_table[13:15,]

# Reorder the factor levels
engagement_factor_correlation_table$variable <- factor(
  engagement_factor_correlation_table$variable,
  levels = engagement_factor_correlation_table$variable
)


# Create a ggplot with horizontal bars for the top 3 Pearson's r correlations
ggplot(engagement_factor_correlation_table, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Top 3 Factors with Strongest Associations to Employee Engagement for Less Engaged Employees", caption = "Correlations calculated using Pearson's r | Only employees with engagement composite factor score lower than or equal to 2 are included for this analysis"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )



#engagement factor's correlations with other factors
library(dplyr)

#Create a df with composite factor scores for each group of items
composite_scores <- df_2 %>% mutate(
    Alignment = rowMeans(select(., ali_1:ali_3), na.rm = TRUE),  # Alignment score
    Collaboration = rowMeans(select(., col_1:col_3), na.rm = TRUE),  # Collaboration score
    Engagement = rowMeans(select(., eng_1:eng_5), na.rm = TRUE),  # Engagement score
    Inclusion = rowMeans(select(., inc_1:inc_5), na.rm = TRUE),  # Inclusion score
    Leadership = rowMeans(select(., lea_1:lea_4), na.rm = TRUE)  # Leadership score
  ) %>%
  # Select only the composite factor scores and an identifier (if needed)
  select(Alignment, Collaboration, Engagement, Inclusion, Leadership)

# Print the new data frame to ensure it contains the expected composite scores
print(composite_scores)

composite_scores_low <- composite_scores %>%
  filter(Engagement <= 2)

composite_factor_scores <- subset(composite_scores_low, select= c(Alignment, Collaboration, Inclusion, Leadership))
print(composite_factor_scores)

engagement_factor_scores <- subset(composite_scores_low, select= -c(Alignment, Collaboration, Inclusion, Leadership))
print(engagement_factor_scores)

#Conduct Kendall's tau-b correlation to get correlations
correlation_matrix_kendall <- cor(composite_scores, method = "kendall", use = "complete.obs")

#Extract the correlations for "engagement_factor"
engagement_correlations_kendall <- correlation_matrix_kendall[, "Engagement"]

engagement_factor_correlation_table_kendall <- data.frame(
  variable = names(engagement_correlations_kendall),
  correlation = engagement_correlations_kendall
)

#Remove 'engagement_factor' and sort by correlation in descending order
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[
  engagement_factor_correlation_table_kendall$variable != "Engagement", 
]
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall %>%
  arrange(correlation)

#Keep only the top 3 strongest correlations
engagement_factor_correlation_table_kendall <- engagement_factor_correlation_table_kendall[1:4, ]

# Reorder the factor levels based on the new order
engagement_factor_correlation_table_kendall$variable <- factor(
  engagement_factor_correlation_table_kendall$variable,
  levels = engagement_factor_correlation_table_kendall$variable
)

# Use scales package to format correlations as percentages
library(scales)


# Create a ggplot with horizontal bars for the top 3 Kendall's tau-b correlations
ggplot(engagement_factor_correlation_table_kendall, aes(x = correlation, y = variable)) +
  geom_bar(stat = "identity", fill = "purple", alpha = 0.7) +
  geom_text(aes(label = percent(correlation, accuracy = 1)), hjust = -0.1, size = 3.5, color = "black")  +
  labs(x = "Correlation", y = "Variable", title = "Factors' relationships with Employee Engagement for Less Engaged Employees", caption = "Correlations calculated using Kendall's tau-b | Only employees with engagement composite factor score lower than or equal to 2 are included for analysis" 
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 10, hjust = 0)
  )

```
<br>
<br>
   
## Calculate Engagement & Leadership Factor Scores for All Countries.
<br>
<br>
   
### Creating a graph comparing factor favorable scores for engagement & leadership across countries
<br>
<br>
        
```{r}
#Create an empty data frame to save the consolidated favorable_scores
consolidated_favorable_scores <- data.frame(
  factor_abbreviation = character(),
  factor_favorable_score = numeric(),
  country = character(),
  stringsAsFactors = FALSE
)

#list of countries
countries <- c("Australia", "Canada", "China", "Denmark", "France", "Germany", "India", "United Kingdom", "United States")  

#Loop through each country and calculate factor favorable score
for (country in countries) {
  #Filter data for the specific country
  country_df <- df_2[df_2$country == country & !is.na(df_2$country), ]
  
  #Calculate favorability_score using a custom function
  favorability_score <- function_favorability(country_df[, c(8:12, 18:21)])
  colnames(favorability_score)[1] <- "question_number"
  
  factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number))
  
  #Create a data frame for this country's factor_favorable_score (so a dataframe within a loop)
  factor_favorable_score <- data.frame(
    factor_abbreviation = character(),
    factor_favorable_score = numeric(),
    country = character(),
    stringsAsFactors = FALSE
  )
  
  #Calculate the average favorable score for each factor
  for (factor_abbr in factor_abbreviations) {
    #Subset favorable scores for the factor
    factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    
    #Calculate the average favorable score
    avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)
    
    #Append the calculated score to the country's data frame
    factor_favorable_score <- rbind(
      factor_favorable_score,
      data.frame(
        factor_abbreviation = factor_abbr,
        factor_favorable_score = avg_favorable_score,
        country = country  # Add the country label
      )
    )
  }
  
  #Consolidate this country's data frame into the main consolidated data frame
  consolidated_favorable_scores <- rbind(
    consolidated_favorable_scores,
    factor_favorable_score
  )
}

print(consolidated_favorable_scores)


#Sort the data frame by factor_favorable_score 
consolidated_favorable_scores <- consolidated_favorable_scores %>%
  arrange(desc(factor_favorable_score))

#Reorder the factor levels based on the sorted data frame
consolidated_favorable_scores$factor_abbreviation <- factor(
  consolidated_favorable_scores$factor_abbreviation,
  levels = unique(consolidated_favorable_scores$factor_abbreviation)  
)
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(scales)

# Filter the data into two subsets: one for 'lea' (leadership factor) and one for 'eng' (engagement factor)
leadership_scores <- consolidated_favorable_scores %>%
  filter(factor_abbreviation == "lea")

engagement_scores <- consolidated_favorable_scores %>%
  filter(factor_abbreviation == "eng")

# Reorder the factor levels based on the sorted data frame
leadership_scores$country <- factor(
  leadership_scores$country,
  levels = unique(leadership_scores$country)
)

engagement_scores$country <- factor(
  engagement_scores$country,
  levels = unique(engagement_scores$country)
)

# Create ggplot for leadership scores
ggplot(leadership_scores, aes(x = country, y = factor_favorable_score * 100, fill = country)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  geom_text(
    aes(label = paste0(round(factor_favorable_score * 100, 1), "%")),
    position = position_dodge(width = 0.9),
    vjust = -0.5  # Position the text above the bars
  ) +
  labs(
    x = "Country",
    y = "Leadership Favorability Score (%)",
    title = "Leadership Factor Favorable Scores by Country (%)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

# Create ggplot for engagement scores
ggplot(engagement_scores, aes(x = country, y = factor_favorable_score * 100, fill = country)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  geom_text(
    aes(label = paste0(round(factor_favorable_score * 100, 1), "%")),
    position = position_dodge(width = 0.9),
      vjust = -0.5,
    size = 3
  ) +
  labs(
    x = "Country",
    y = "Engagement Favorability Score (%)",
    title = "Engagement Factor Favorable Scores by Country (%)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )
```


```{r}
# Create a dataframe to save the consolidated factor scores
consolidated_favorable_scores <- data.frame(
  factor_abbreviation = character(),
  factor_favorable_score = numeric(),
  country = character(),
  stringsAsFactors = FALSE
)

# List of countries
countries <- c("Australia", "Canada", "China", "Denmark", "France", "Germany", "India", "United Kingdom", "United States")

# Loop through each country and calculate factor favorable score
for (country in countries) {
  # Filter data for the specific country
  country_df <- df_2[df_2$country == country & !is.na(df_2$country), ]

  # Calculate favorability_score using a custom function for leadership factor
  favorability_score <- function_favorability(country_df[, c(18:21)])  # 'lea' questions
  colnames(favorability_score)[1] <- "question_number"

  # Create a data frame for this country's factor_favorable_score
  factor_favorable_score <- data.frame(
    factor_abbreviation = character(),
    factor_favorable_score = numeric(),
    country = character(),
    stringsAsFactors = FALSE
  )

  # Calculate the average favorable score for each factor
  for (factor_abbr in unique(sub("_.*", "", favorability_score$question_number))) {
    # Subset favorable scores for the factor
    factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    
    # Calculate the average favorable score
    avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)
    
    # Append the calculated score to the data frame
    factor_favorable_score <- rbind(
      factor_favorable_score,
      data.frame(
        factor_abbreviation = factor_abbr,
        factor_favorable_score = avg_favorable_score,
        country = country  # Add the country label
      )
    )
  }

  # Consolidate this country's data frame into the main consolidated data frame
  consolidated_favorable_scores <- rbind(
    consolidated_favorable_scores,
    factor_favorable_score
  )
}

# Now calculate the company's average leadership score based on all employees
all_employees_df <- df_2  # Full dataset
company_favorability_score <- function_favorability(all_employees_df[, c(18:21)])  # 'lea' questions
company_avg_leadership_score <- mean(company_favorability_score$favorability_score, na.rm = TRUE)  # Average leadership factor

# Create a row for the company's average score
company_average_row <- data.frame(
  factor_abbreviation = "lea",
  factor_favorable_score = company_avg_leadership_score,
  country = "Company Average"  # Label for the overall company
)

# Add the company's average to the consolidated data frame
consolidated_favorable_scores <- rbind(company_average_row, consolidated_favorable_scores)

# Define the desired order for the countries
desired_order <- c("Company Average", "India", "France", "Australia", "United Kingdom", "Germany", "Canada", "Denmark", "China", "United States")

# Reorder the factor levels for proper display
consolidated_favorable_scores$country <- factor(
  consolidated_favorable_scores$country,
  levels = desired_order  # 'Company Average' first, then other countries in the desired order
)

# Create a ggplot for leadership scores including the company average
ggplot(consolidated_favorable_scores, aes(x = country, y = factor_favorable_score * 100, fill = country)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  geom_text(
    aes(label = paste0(round(factor_favorable_score * 100, 1), "%")),
    position = position_dodge(width = 0.9),
    vjust = -0.5,
    size = 3
  ) +
  labs(
    x = "Country",
    y = "Leadership Favorability Score (%)",
    title = "Leadership Factor Favorable Scores by Country (%)"
  ) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```
```{r}
library(ggplot2)
library(dplyr)
library(scales)

# Create a dataframe to save the consolidated factor scores
consolidated_favorable_scores <- data.frame(
  factor_abbreviation = character(),
  factor_favorable_score = numeric(),
  country = character(),
  stringsAsFactors = FALSE
)

# List of countries
countries <- c("India", "Canada", "France", "Australia", "United Kingdom", "Denmark", "China", "United States", "Germany")

# Loop through each country and calculate factor favorable score
for (country in countries) {
  # Filter data for the specific country
  country_df <- df_2[df_2$country == country & !is.na(df_2$country), ]

  # Calculate favorability_score using a custom function for 'eng' questions (Engagement)
  favorability_score <- function_favorability(country_df[, c(8:12)])
  colnames(favorability_score)[1] <- "question_number"

  # Create a data frame for this country's factor_favorable_score
  factor_favorable_score <- data.frame(
    factor_abbreviation = "eng",
    factor_favorable_score = mean(favorability_score$favorability_score, na.rm = TRUE),
    country = country
  )

  # Consolidate this country's data frame into the main consolidated data frame
  consolidated_favorable_scores <- rbind(consolidated_favorable_scores, factor_favorable_score)
}


# Now calculate the company's average leadership score based on all employees
all_employees_df <- df_2  # Full dataset
company_favorability_score <- function_favorability(all_employees_df[, c(8:12)])  # 'eng' questions
company_avg_engagement_score <- mean(company_favorability_score$favorability_score, na.rm = TRUE)  # Average engagement factor

# Create a row for the company's average score
company_average_row <- data.frame(
  factor_abbreviation = "eng",
  factor_favorable_score = company_avg_engagement_score,
  country = "Company Average"  # Label for the overall company
)


# Add the company's average engagement score to the consolidated data frame
company_average_row <- data.frame(
  factor_abbreviation = "eng",
  factor_favorable_score = company_avg_engagement_score,
  country = "Company Average"
)
consolidated_favorable_scores <- rbind(company_average_row, consolidated_favorable_scores)

# Define the desired order for the countries
desired_order <- c("Company Average", "India", "Canada", "France", "Australia", "United Kingdom", "Denmark", "China", "United States", "Germany")

# Reorder the countries for proper display
consolidated_favorable_scores$country <- factor(
  consolidated_favorable_scores$country,
  levels = desired_order
)

# Create ggplot for engagement scores
ggplot(consolidated_favorable_scores, aes(x = country, y = factor_favorable_score * 100, fill = country)) +
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  geom_text(
    aes(label = paste0(round(factor_favorable_score * 100, 1), "%")),  
    position = position_dodge(width = 0.9),  
    vjust = -0.5,  
    size = 3  
  ) +
  labs(
    x = "Country",
    y = "Engagement Favorability Score (%)",
    title = "Engagement Factor Favorable Scores by Country (%)"
  ) +
  scale_y_continuous(labels = percent_format(scale = 1)) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)  
  )
```


<br>
<br>
   
### Australia's

<br>
<br>
n = 101
```{r}
df_2[df_2$country == "Australia" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Australia", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Australia"  # Add the country label
    )
  )
}




print(factor_favorable_score)

favorability_score$Country <- "Australia" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for Aussie employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for Aussie Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1)) 
```
<br>
<br>
   
### Canada's
<br>
<br>
n = 84
```{r}
df_2[df_2$country == "Canada" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Canada", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Canada"  # Add the country label
    )
  )
}




print(factor_favorable_score)

favorability_score$Country <- "Canada" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for Danish employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for Canadian Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))
```
<br>
<br>

### China's
<br>
<br>
n = 60   
```{r}
df_2[df_2$country == "China" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "China", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "China"  # Add the country label
    )
  )
}




print(factor_favorable_score)

favorability_score$Country <- "China" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for Chinese employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for Chinese Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))
```
<br>
<br>
   
### Denmark's 
<br>
<br>
n = 24
```{r}
df_2[df_2$country == "Denmark" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Denmark", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Denmark"  # Add the country label
    )
  )
}



print(factor_favorable_score)

favorability_score$Country <- "Denmark" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for Danish employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for Danish Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))  
```
<br>
<br>
   
### France's
<br>
<br>
n = 136
   
```{r}
df_2[df_2$country == "France" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "France", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "France"  # Add the country label
    )
  )
}



print(factor_favorable_score)

favorability_score$Country <- "France" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for French employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for French Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))  

```  
<br>
<br>

### Germany's
<br>
<br>
n = 48
   
```{r}
df_2[df_2$country == "Germany" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "Germany", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "Germany"  # Add the country label
    )
  )
}


print(factor_favorable_score)

favorability_score$Country <- "Germany" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for German employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for German Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))  


#Desired order of question_number in reverse as I am making a horizontal graph
desired_order <- c("eng_5", "eng_4", "eng_3", "eng_2", "eng_1", "eng")

#Set the factor levels in reverse order
engagement_favorable_scores$question_number <- factor(
  engagement_favorable_scores$question_number,
  levels = (desired_order)  # Reverse the desired order
)

#Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_score_for_all$question_number == engagement_favorable_scores$question_number[1], "first", "other")




#Color palette for highlighting
highlight_colors <- c("first" = "#9A36B2",  # Purple for the 'first' category
                      "other" = "#C9A5DD")  # light purple for the 'other' category

#Create a horizontal bar plot with ggplot
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score*100, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE) + 
  coord_flip() +  
  labs(
    x = "Factor Items",  
    y = "Favorability Score (%)", 
    title = "Engagement Factor Favorable Scores for Employees in Germany",
    caption = "Favorability score represents the percentage of respondents who agreed or strongly agreed with the question item over all non-missing responses. Factor favorability score is an average of all the items for the factor."  
  ) +
  theme_minimal() + 
  theme(
    axis.text.y = element_text(size = 12),  
    axis.text.x = element_text(size = 12), 
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),  
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14),
  plot.caption = element_text(size = 6, hjust = 0)  
  ) +
  geom_text(aes(label = paste0(round(favorability_score*100), "%")), 
            hjust = -0.3,  
            size = 4) +  
  scale_fill_manual(values = highlight_colors)  
```
<br>
<br>
   
### India's 
<br>
<br>
n = 288
```{r}

df_2[df_2$country == "India" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "India", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "India"  # Add the country label
    )
  )
}


print(factor_favorable_score)

favorability_score$Country <- "India" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for Indian employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for Indian Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))  


```
<br>
<br>
   
### United Kingdom's
<br>
<br>
n = 359       
```{r}
df_2[df_2$country == "United Kingdom" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "United Kingdom", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "United Kingdom"  # Add the country label
    )
  )
}


print(factor_favorable_score)

favorability_score$Country <- "United Kingdom" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for U.S. employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for U.K. Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))  


```
<br>
<br>
   
### United States'
<br>
<br>

n = 1551
```{r}

df_2[df_2$country == "United States" & !is.na(df_2$country), ]

# Calculate favorability_score for columns 8 to 12 (engagement questions) by using function_favorability I created.
favorability_score <- function_favorability(df_2[df_2$country == "United States", c(8:12, 18:21)])
colnames(favorability_score)[1] <- "question_number"
print(favorability_score)

# Calculate factor favorability score for engagement & leadership 

## Extract factor abbreviations first
factor_abbreviations <- unique(sub("_.*", "", favorability_score$question_number)) #substitute "-.*" to " " then only save unique abbreviations

## Create an empty data frame to save the calculated factor_favorable_score for each factor
factor_favorable_score <- data.frame(factor_abbreviation = character(),
                                     factor_favorable_score = numeric(),
                                     stringsAsFactors = FALSE)

## Calculate the average favorable score for each factor by using this function:
for (factor_abbr in factor_abbreviations) {
  # Subset favorable scores for questions belonging to the factor by using 'factor_abbreviations' vector 
  factor_scores <- favorability_score[grep(paste0("^", factor_abbr, "_"), favorability_score$question_number), ]
    #use grep to find 'factor_abbre_" in favorability_score df
  
  # Calculate the average favorable score for the factor
  avg_favorable_score <- mean(factor_scores$favorability_score, na.rm = TRUE)  # Add na.rm = TRUE to handle missing values
  
  # Add each factor favorable score to the data frame
  factor_favorable_score <- rbind(
    factor_favorable_score,
    data.frame(
      factor_abbreviation = factor_abbr,
      factor_favorable_score = avg_favorable_score,
      country = "United States"  # Add the country label
    )
  )
}

print(factor_favorable_score)

favorability_score$Country <- "United States" 

#let's combine these two dfs
colnames(factor_favorable_score) <- c("question_number", "favorability_score", "Country")
combined_favorability_df <- rbind(favorability_score, factor_favorable_score)
combined_favorability_df <- combined_favorability_df[order(combined_favorability_df$question_number), ]
print(combined_favorability_df)

#let's only keep engagement scores

engagement_favorable_scores <- combined_favorability_df[1:6, ] 
print(engagement_favorable_scores)


# Distinguish the average row from other item rows
engagement_favorable_scores$highlight <- ifelse(engagement_favorable_scores$question_number == engagement_favorable_scores $question_number[1], "first", "other")

# Create a color palette to specify the average factor favorable score from others
highlight_colors <- c("first" = "#5E81AC",  # blue for the 'first' category
                      "other" = "#AEBAC2")  # Grey for the 'other' category


library(scales)

# Create a ggplot that shows engagement factor favorable scores for U.S. employees
ggplot(engagement_favorable_scores, aes(x = question_number, y = favorability_score, fill = highlight)) +
  geom_bar(stat = "identity", show.legend = FALSE, width = 0.6) +  
  labs(x = "Factor Items", y = "Favorability Score (%)", title = "Engagement Factor Favorable Scores for U.S. Employees") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5, size = 12),
    axis.text.y = element_text(size = 12),  
    plot.title = element_text(hjust = 0.5, size = 16), 
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_text(size = 14) 
  ) +
  geom_text(aes(label = paste0(round(favorability_score * 100), "%")), vjust = -0.5, size = 4) + 
  scale_fill_manual(values = highlight_colors) +  
  scale_y_continuous(labels = percent_format(accuracy = 1))  

```
<br>
<br>

## Demographic Composition of the Company
<br>
<br>

### By country

<br>
<br>
```{r}
library(ggplot2)
library(dplyr)

country_df <- as.data.frame(table(df_2$country))
colnames(country_df) <- c("Country", "Count")


##bar graph
ggplot(country_df, aes(x = Country, y = Count, fill = Country)) +  
  geom_bar(stat = "identity") +  
  labs(
    x = "Country",  
    y = "Employee Count",  
    title = paste("Employee Distribution Across Countries"),
  caption = "Total: 2651 employees"  
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(hjust = 1, face = "italic")  
  ) +
  geom_text(aes(label = paste(Count)), vjust = -0.5, size = 3.5)  

# Calculate the proportion of employees for each country
country_df <- country_df %>%
  mutate(Proportion = Count / sum(Count))  

ggplot(country_df, aes(x = "", y = Proportion, fill = Country)) +
  geom_bar(stat = "identity", width = 1) +  
  coord_polar(theta = "y") + 
  labs(
    x = NULL, 
    y = NULL,  
    title = "Employee Distribution by Country (Percentage)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),  
    panel.grid = element_blank() 
  ) +
  geom_text(aes(label = paste(Country, scales::percent(Proportion, accuracy = 0.1))), 
            position = position_stack(vjust = 0.5),  # Center text on each slice
            size = 3)  

# barchart in percentage

ggplot(country_df, aes(x = Country, y = Proportion*100, fill = Country)) +
  geom_bar(stat = "identity") +  
  labs(
    x = "Country", 
    y = "Proportion (%)",  
    title = "Employee Distribution by Country (Percentage)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)  
  ) +
  geom_text(aes(label = paste0(round(Proportion*100, 1), "%")),  
            vjust = -0.5, 
            size = 3.5)  
```

<br>
<br>

### By gender

<br>
<br>

```{r}
#by gender

gender_df <- as.data.frame(table(df_2$gender, useNA = "always"))
colnames(gender_df) <- c("Gender", "Count")
gender_df <- gender_df %>%
  mutate(
    Gender = case_when(
      Gender == "Female" ~ "Women",  
      Gender == "Male" ~ "Men",  
      is.na(Gender) ~ "Unknown",  
      TRUE ~ Gender  # Keep other values unchanged
    )
  )
gender_df

gender_df$Tenure <- factor(
    gender_df$Gender, 
    levels = c("Men", "Women", "Unknown"))

total_employees <- sum(gender_df$Count)

ggplot(gender_df, aes(x = "", y = Count, fill = Gender)) +
  geom_bar(stat = "identity", width = 1) +  
  coord_polar(theta = "y") +  
  labs(
    x = NULL,  
    y = NULL,  
    title = paste("Employee Distribution Across Gender (Total:", total_employees, "employees)")  # Add total employees in the title
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),  
    panel.grid = element_blank()  
  ) +
  geom_text(aes(label = paste(Gender, " : ", Count)),  
            position = position_stack(vjust = 0.5),  
            size = 3.5)

##bar graph
ggplot(gender_df, aes(x = Gender, y = Count, fill = Gender)) +  
  geom_bar(stat = "identity") +  
  labs(
    x = "Gender Group",  
    y = "Employee Count",  
    title = paste("Employee Distribution Across Gender Groups"),
  caption = "Total: 2651 employees"  
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(hjust = 1, face = "italic")  
  ) +
  geom_text(aes(label = paste(Count)), vjust = -0.5, size = 3.5)

```
<br>
<br>

### By tenure

<br>
<br>

```{r}
#by tenure group


tenure_df <- as.data.frame(table(df_2$tenure_group))
colnames(tenure_df) <- c("Tenure", "Count")

tenure_df$Tenure <- factor(
    tenure_df$Tenure, 
    levels = c("Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years", "10+ years"))

    
tenure_df

total_employees <- sum(tenure_df$Count)

##bar graph
ggplot(tenure_df, aes(x = Tenure, y = Count, fill = Tenure)) +  
  geom_bar(stat = "identity") +  
  labs(
    x = "Tenure Group",  
    y = "Employee Count",  
    title = paste("Employee Distribution Across Tenure Groups"),
  caption = "Total: 2651 employees"  
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(hjust = 1, face = "italic")  
  ) +
  geom_text(aes(label = paste(Count)), vjust = -0.5, size = 3)  
```

<br>
<br>

### By tenure  & gender

<br>
<br>

```{r}
#by tenure & gender

library(ggplot2)
library(dplyr)

#Create separate data frames for men and women by tenure group
men_tenure_df <- as.data.frame(table(df_2$tenure_group[df_2$gender == "Male"]))
women_tenure_df <- as.data.frame(table(df_2$tenure_group[df_2$gender == "Female"]))

colnames(men_tenure_df) <- c("Tenure", "Count")
colnames(women_tenure_df) <- c("Tenure", "Count")

#Ensure the tenure groups are in the correct order
tenure_levels <- c("Under 3 months", "3-6 months", "6-12 months", "1-2 years", "2-4 years", "4-6 years", "6-10 years", "10+ years")

men_tenure_df$Tenure <- factor(men_tenure_df$Tenure, levels = tenure_levels)
women_tenure_df$Tenure <- factor(women_tenure_df$Tenure, levels = tenure_levels)

#Add a gender column to each data frame
men_tenure_df$Gender <- "Men"
women_tenure_df$Gender <- "Women"

#Combine the two data frames
combined_tenure_df <- rbind(men_tenure_df, women_tenure_df)

#Create a bar plot comparing men and women by tenure group
ggplot(combined_tenure_df, aes(x = Tenure, y = Count, fill = Gender)) +  
  geom_bar(stat = "identity", position = "dodge") +  # Bars side-by-side
  labs(
    x = "Tenure Group",  
    y = "Employee Count",  
    title = "Employee Distribution by Tenure Group and Gender",
    caption = "Total: 2651 employees"  
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(hjust = 1, face = "italic")  
  ) +
  geom_text(aes(label = Count), position = position_dodge(width = 0.9), vjust = -0.5, size = 3)  

